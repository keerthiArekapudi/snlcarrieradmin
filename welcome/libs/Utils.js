/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
$.sap.declare("splReusable.Utils");
splReusable.Utils=function(){this.aUUID=[];this.oSapSplUUIDModel=null;this.sIncludePsp=null;this.deviceId=null;this.oSapSplCore=sap.ui.getCore();this.oSplL10NBundle=jQuery.sap.resources({url:"./resources/l10n/label.properties",locale:sap.ui.getCore().getConfiguration().getLanguage()});var t=this;this.oSplQueryParametersMap={};this.oSapSplMessageBundleFactory={resourceBundleObject:null,getResourceInstance:function(p){if(t.oSapSplMessageBundleFactory.resourceBundleObject===null){t.oSapSplMessageBundleFactory.resourceBundleObject={};t.oSapSplMessageBundleFactory.resourceBundleObject[p]=$.sap.resources({url:p,locale:sap.ui.getCore().getConfiguration().getLanguage()});}else{if(!t.oSapSplMessageBundleFactory.resourceBundleObject.hasOwnProperty(p)){t.oSapSplMessageBundleFactory.resourceBundleObject[p]=$.sap.resources({url:p,locale:sap.ui.getCore().getConfiguration().getLanguage()});}}return t.oSapSplMessageBundleFactory.resourceBundleObject[p];}};this.isPageDirty=false;this.errorMessageMapper={errorMessages:[{iName:"Organization.Name",eName:this.getBundle().getText("ORGANIZATION_NAME_FIELD")},{iName:"CommunicationInfo.EmailAddress",eName:this.getBundle().getText("EMAIL")},{iName:"CommunicationInfo.Phone",eName:this.getBundle().getText("PHONE")},{iName:"CommunicationInfo.Fax",eName:this.getBundle().getText("FAX")},{iName:"PersonName.Surname",eName:this.getBundle().getText("PERSON_SURNAME_FIELD")},{iName:"PersonName.GivenName",eName:this.getBundle().getText("PERSON_GIVENNAME_FIELD")},{iName:"Role",eName:this.getBundle().getText("ROLE")}]};};
splReusable.Utils.prototype.getBundle=function(){return this.oSplL10NBundle;};
splReusable.Utils.prototype.getBusinessMessageBundle=function(){return this.oSplL10NBundle;};
splReusable.Utils.prototype.getFQServiceUrl=function(s){try{if(!window.location.origin){window.location.origin=window["location"]["protocol"]+"//"+window["location"]["hostname"]+(window.location.port?":"+window.location.port:"");}if(s&&s!==null&&typeof(s)==="string"){var p=new RegExp("localhost","gi");var r=p.exec(window.location.hostname);if(r!==null&&window.location.hostname===r[0]){if(s.charAt(0)!=="/"){s="proxy/"+s;}else{s="proxy"+s;}}else{if(s.charAt(0)!=="/"){s=window["location"]["origin"]+"/"+s;}else{s=window["location"]["origin"]+s;}}}else{throw new splReusable.exceptions.MissingParametersException({source:this.toString(),message:"serviceUrl argument missing",options:{severity:"Information"}});}}catch(e){if(e.constructor===splReusable.exceptions.MissingParametersException){jQuery.sap.log.error(e.message,"Failure of getFQServiceUrl function call","Utils.js");}}return s;};
splReusable.Utils.prototype.setServiceMetadata=function(s){this.oServiceUrls=s;};
splReusable.Utils.prototype.getServiceMetadata=function(s,g){try{var _=null;if(s!==undefined&&s!==null){if(s.constructor===String){for(var i=0;i<this.oServiceUrls.services.length;i++){if(g){if(this.oServiceUrls.services[i].id===s){_=this.getFQServiceUrl(this.oServiceUrls.services[i]["value"]);}}else{if(this.oServiceUrls.services[i].id===s){_=this.oServiceUrls.services[i];}}}return _;}else{throw new TypeError();}}else{throw new ReferenceError();}}catch(e){if(e.constructor===Error){jQuery.sap.log.error(e.message,"Failure of getServiceMetadata function call","Utils.js");}}};
splReusable.Utils.prototype.validateEmailID=function(e){if(typeof(e)==="object"){var a="";if(e["pattern"]!==undefined){a=e["pattern"];}else{a=/^([a-zA-Z0-9]+[a-zA-Z0-9._%-]*@(?:[a-zA-Z0-9-]+\.)+[a-zA-Z]{2,4})$/;}var b=a.test(e["email"]);return b;}else{throw new TypeError();}};
splReusable.Utils.prototype.getResolvedEntityNameForNavigation=function(s,a){var r=null;try{if(arguments===undefined||arguments.length<0){throw new splReusable.exceptions.MissingParametersException({message:SapSplEnums.missing_parameter,source:this.toString(),options:{severity:SapSplEnums.fatal}});}else{if(s){if(a===undefined||a===null){a="appl";}r=s.split(this.getODataServiceUrl(a))[1];}}}catch(e){if(e.constructor===splReusable.exceptions.MissingParametersException){jQuery.sap.log.error(e.message,"Failure of getResolvedEntityNameForNavigation function call","Utils.js");}}return"/"+r;};
splReusable.Utils.prototype.getUUID=function(){var _=new RegExp("[+/?%#&]+"),u=null,t=this;if(this.aUUID.length>10){u=this.aUUID.pop().UUID;}else if(this.aUUID.length<=0){this.fetchUUIDs(false,function(){u=t.aUUID.pop().UUID;});}else if(this.aUUID.length<=10){this.fetchUUIDs(true,function(){u=t.aUUID.pop().UUID;});}return u;};
function maintainArrayOfUUID(d,t,X){var r=d.d;$.sap.log.info("SAP SCL Welcome Utils","XMLHTTPRequest status"+X.status.toString(),"SAPSCL");$.sap.log.info("SAP SCL Welcome Utils","TextStatus "+t.toString(),"SAPSCL");for(var U=1;U<r.results.length;U++){this.aUUID.push(r.results[U]);}}
splReusable.Utils.prototype.fetchUUIDs=function(a,c){var t=this;jQuery.ajax({url:t.getFQServiceUrl("/sap/spl/xs/selfRegistration/data.xsodata/")+"UUID?$format=json",async:a,json:true,beforeSend:function(r){r.setRequestHeader("X-CSRF-Token","Fetch");},success:function(d,b,X){var r=d.d;$.sap.log.info("SAP SCL Welcome Utils","XMLHTTPRequest status"+X.status.toString(),"SAPSCL");$.sap.log.info("SAP SCL Welcome Utils","TextStatus "+b.toString(),"SAPSCL");for(var U=1;U<r.results.length;U++){t.aUUID.push(r.results[U]);}c();}});};
splReusable.Utils.prototype.setCSRFToken=function(S){try{if(!this.SapSplCSRFToken){this.SapSplCSRFToken=S;}else{throw new Error();}}catch(e){if(e.constructor===Error){jQuery.sap.log.error("Failure of setCSRFToken function call","Perhaps due to missing CSRF setting. POST actions might fail","splReusable.Utils.setCSRFToken()");}}};
splReusable.Utils.prototype.getCSRFToken=function(){try{if(this.SapSplCSRFToken){return this.SapSplCSRFToken;}else{throw new Error();}}catch(e){if(e.constructor===Error){jQuery.sap.log.error(e.message,"Failure of getCSRFToken function call","Utils.js");}}};
splReusable.Utils.prototype.failureOfUUIDFetch=function(){};
splReusable.Utils.prototype.IsValidArray=function(a){if(arguments&&arguments.length<0){throw new splReusable.exceptions.MissingParametersException({message:"Invalid arguments passed",source:this.toString(),options:{severity:SapSplEnums.fatal}});}else{if(a.hasOwnProperty("length")&&typeof a.length==="number"){return true;}else{return false;}}};
splReusable.Utils.prototype.getErrorMessagesfromErrorPayload=function(e){var t=this;var _={"errors":[]},a=null,b=null,r={completeErrorObject:null,ufErrorObject:null,errorWarningString:null,messageTitle:{title:null,valueState:null}};if(arguments===undefined||arguments.length<=0){throw new splReusable.exceptions.MissingParametersException({message:"Missing arguments. Invalid usage",source:this.toString(),options:{severity:SapSplEnums.fatal}});}function c(p){return p.split(".").join("/")+"/";}function d(j){var k=[],l=false;for(var m=0,C=j.errors.length;m<C;m++){jQuery.each(j.errors[m]["UFLocation"],function(K,v){k.push(v+" : "+j.errors[m]["Message"]["UFMessage"]);l=true;});if(l){l=false;continue;}k.push(j.errors[m]["Message"]["UFMessage"]);}return k.join("\n");}function f(s){for(var j=0,C=t.errorMessageMapper.errorMessages.length;j<C;j++){for(var k=0,l=s.length;k<l;k++){if(s[k]===t.errorMessageMapper.errorMessages[j]["iName"]){b["UFLocation"][t.errorMessageMapper.errorMessages[j]["iName"]]=t.errorMessageMapper.errorMessages[j]["eName"];break;}}}}function g(_){var j=0,k=0,l="";if(t.IsValidArray(_.errors)){for(var m=0,C=_.errors.length;m<C;m++){if(_.errors[m]["Severity"]==="E"){j++;}else if(_.errors[m]["Severity"]==="W"){k++;}}l=t.getBundle().getText("IDENTIFIED_ERRORS_AND_WARNINGS",[j,k]);}else{l=t.getBundle().getText("MALFORMED_ERROR_OBJECT");}return{value:l,count:j+k,errorCount:j,warningCount:k};}function h(o){var j=g(o);var k=j["errorCount"];var w=j["warningCount"];r["completeErrorObject"]=o;r["ufErrorObject"]=d(o);if(k>0&&w===0){r["errorWarningString"]=t.getBundle().getText("SPL_ERROR_MESSAGE");r["messageTitle"]["title"]=t.getBundle().getText("SPL_ERROR_DIALOG_HEADER");r["messageTitle"]["valueState"]="Error";}else if(k===0&&w>0){r["errorWarningString"]=t.getBundle().getText("SPL_WARNING_MESSAGE");r["messageTitle"]["title"]=t.getBundle().getText("SPL_WARNING_DIALOG_HEADER");r["messageTitle"]["valueState"]=sap.ui.core.ValueState.Warning;}else if(k>0&&w>0){r["errorWarningString"]=t.getBundle().getText("SPL_ERROR_WARNING_MESSAGE");r["messageTitle"]["title"]=t.getBundle().getText("SPL_ERROR_WARNING_DIALOG_HEADER");r["messageTitle"]["valueState"]="None";}else{return r;}return r;}if(e.hasOwnProperty("Error")){if(e.Error.length>0){var i=e.Error;for(var E=0,C=i.length;E<C;E++){b={"Severity":null,"ObjectType":null,"Entity":null,"Keys":{"UUID":null},"Message":{"Package":null,"Bundle":null,"ID":null},"Location":[],"UFLocation":{},"TextSubstitutionValues":null,"Text":null};b.Severity=i[E]["Severity"];b.ObjectType=i[E]["ObjectType"];b.Entity=i[E]["Entity"];b.Location=i[E]["Location"];b["Keys"]["UUID"]=i[E]["Keys"]["UUID"];b["Message"]["Package"]=i[E]["Message"]["Package"];b["Message"]["Bundle"]=i[E]["Message"]["Bundle"];b["Message"]["ID"]=i[E]["Message"]["ID"];b["TextSubstitutionValues"]=i[E]["TextSubstitutionValues"];b["Text"]=i[E]["Text"];if((i[E]["TextSubstitutionValues"]&&i[E]["TextSubstitutionValues"]!==null)&&i[E]["TextSubstitutionValues"].hasOwnProperty("length")&&i[E]["TextSubstitutionValues"].length>0){a=i[E]["TextSubstitutionValues"];}b["Message"]["UFMessage"]=this.oSapSplMessageBundleFactory.getResourceInstance(this.getFQServiceUrl(c(b["Message"]["Package"])+b["Message"]["Bundle"]+".hdbtextbundle")).getText(b["Message"]["ID"],a);f(b["Location"]);_.errors.push(b);}}else{jQuery.sap.log.error("Error message payload","Invalid error object format","splReusable.libs.Utils.getErrorMessageFromErrorPayload");}}else{jQuery.sap.log.error("Error message paylaod","Missing Error/Message field on payload","splReusable.libs.Utils.getErrorMessagesfromErrorPayload");}jQuery.sap.log.info("Error message object","Message object prepared with detailed information","splReusable.libs.Utils");return h(_);};
splReusable.Utils.prototype.isObjectEmpty=function(o){if(arguments===undefined||arguments===null||arguments.length<=0){throw new splReusable.exceptions.MissingParametersException({message:"Invalid usage",source:this.toString(),options:{severity:SapSplEnums.fatal}});}if(o.constructor!==Object){throw new TypeError();}try{if(o.constructor===Object){for(var k in o){if(o.hasOwnProperty(k)){return false;}}return true;}else{throw new Error();}}catch(e){if(e.constructor===Error){jQuery.sap.log.error(e.message,"oObject is not an object - isObjectEmpty","Utils.js");}}};
splReusable.Utils.prototype.showMessage=function(m){if(arguments===undefined||arguments.length<=0){throw new splReusable.exceptions.MissingParametersException({message:"Missing arguments. showMessage",source:this.toString(),options:{severity:SapSplEnums.fatal}});}try{if(m.constructor===Object){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:m.message,details:m.details});}else{throw new TypeError();}}catch(e){if(e.constructor===Error){jQuery.sap.log.error(e.message,"oMessageBoxSettings is not an object - oMessageBoxSettings","Utils.js");}}};
splReusable.Utils.prototype.getCoreInstance=function(){return this.oSapSplCore;};
splReusable.Utils.prototype.isInIframe=function(i){if(window.self&&window.top){i(window.self!==window.top);}else{throw new Error("Window object not supported by browser");}};
splReusable.Utils.prototype.getIncludePsp=function(){return this.sIncludePsp;};
splReusable.Utils.prototype.getDeviceID=function(){return this.deviceId;};
splReusable.Utils.prototype.getRegistrationNumber=function(){return this.registrationNumber;};
splReusable.Utils.prototype.setIncludePsp=function(){this.sIncludePsp="x";};
splReusable.Utils.prototype.setDeviceID=function(v){this.deviceId=v;};
splReusable.Utils.prototype.setRegistrationNumber=function(v){this.registrationNumber=v;};
var oSapSplUtils=new splReusable.Utils();oSapSplUtils.getUUID();
