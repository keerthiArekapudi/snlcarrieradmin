/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.controller("splDemoController.SPLDemoAppSetup",{onInit:function(){this.oODataModel=new sap.ui.model.odata.ODataModel(oSapSplUtils.getFQServiceUrl("sap/spl/xs/demoSetup/services/demo.xsodata"),true);this.oODataModel.setSizeLimit(1000);this.oModelForVehicles=new sap.ui.model.json.JSONModel();this.oModelForPaths=new sap.ui.model.json.JSONModel();this.getPredefinedPaths();this.oMappingObject={};this.getView().oOrgSelect.setModel(this.oODataModel);this.getView().oVehiclesTable.setModel(this.oModelForVehicles);},getPredefinedPaths:function(){var t=this;this.oODataModel.read("/PredefinedPaths",null,null,false,function(d){d.results.unshift({Name:"Select a Path",ID:"placeholder"});t.oModelForPaths.setData(d.results);},function(){});},fnHandleChangeEventOfOrgSelect:function(e){var t=this;var U=e.getParameters().selectedItem.getBindingContext().getObject()["UUID"];U=oSapSplUtils.base64ToHex(U);var f="$filter=("+encodeURIComponent("Organization_UUID eq "+"X"+"\'"+U+"\'")+")";this.oODataModel.read("/Vehicles",null,[f],false,function(d){t.oModelForVehicles.setData(d.results);},function(){});},fnHandleAssignAction:function(){var p=[];jQuery.each(this.oMappingObject,function(k,v){p.push({DeviceUUID:k,Path:v});});if(p.length>0){$.ajax({url:oSapSplUtils.getFQServiceUrl("/sap/spl/xs/demoSetup/services/movementSetup.xsjs"),type:"POST",contentType:"json; charset=UTF-8",async:false,beforeSend:function(){},data:JSON.stringify({data:p}),success:function(d,s,m){if(d.constructor===String){d=JSON.parse(d);}if(m["status"]===200&&d["Error"].length===0){sap.m.MessageToast.show("Assignment Done");}},error:function(){sap.m.MessageToast.show("Assignment Error");},complete:function(){}});}},fnHandleChangeEventOfPathSelect:function(e){var b=e.getParameters().selectedItem.getBindingContext().getObject();var p=e.getSource().getParent().getBindingContext().getObject();if(b["ID"]==="placeholder"){this.oMappingObject[p["Device_UUID"]]=null;}else{this.oMappingObject[p["Device_UUID"]]=b["Name"];}},onAfterRendering:function(){},onBeforeRendering:function(){},onBeforeShow:function(){}});
