/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.controller("splController.registeration.MyContactDetails",{onInit:function(){this.unifiedShell=null;var m=new sap.ui.model.json.JSONModel({noData:true,isClicked:false,showFooterButtons:false});sap.ui.getCore().setModel(m,"myContactDetailModel");this.getView().setModel(sap.ui.getCore().getModel("myContactDetailModel"));this.fnDefineControlLabelsFromLocalizationBundle();},fnDefineControlLabelsFromLocalizationBundle:function(){this.byId("MyContactsDetailPage").setTitle(oSapSplUtils.getBundle().getText("MY_COLLEAGUES_DETAIL_TITLE",oSapSplUtils.getCompanyDetails()["Organization_Name"]));this.byId("MyContactDetailsEditButton").setProperty("text",oSapSplUtils.getBundle().getText("MY_COLLEAGUES_EDIT_BUTTON"));this.byId("MyContactDetailsDeleteButton").setProperty("text",oSapSplUtils.getBundle().getText("INCIDENTS_FOOTER_DELETE"));this.byId("sapSplMyUserDetailEmail").setText(oSapSplUtils.getBundle().getText("EMAIL"));this.byId("sapSplMyUserDetailPhone").setText(oSapSplUtils.getBundle().getText("PHONE"));this.byId("sapSplMyUserDetailAccountCreatedOn").setText(oSapSplUtils.getBundle().getText("ACCOUNT_CREATED_ON"));this.byId("sapSplUsersDetailNoDataLabel").setText(oSapSplUtils.getBundle().getText("NO_USERS_TEXT"));this.byId("MyContactDetailsEditButton").setTooltip(oSapSplUtils.getBundle().getText("MY_COLLEAGUES_EDIT_BUTTON"));},fnDeleteUserServiceCall:function(){var s=jQuery.extend(true,{},sap.ui.getCore().getModel("myContactDetailModel").getData());var f={"inputHasChangeMode":true,"Header":[{"UUID":s["UUID"],"BasicInfo.Type":s["BasicInfo_Type"],"ChangeMode":"D"}]};var e=oSapSplUtils.getServiceMetadata("bupa",true);oSapSplBusyDialog.getBusyDialogInstance().open();oSapSplAjaxFactory.fireAjaxCall({method:"PUT",url:e,data:JSON.stringify(f),success:function(r,t,x){if(r.constructor===String){r=JSON.parse(r);}if(x.status===200){if(r["Error"].length>0){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getErrorMessagesfromErrorPayload(r)["errorWarningString"],details:oSapSplUtils.getErrorMessagesfromErrorPayload(r)["ufErrorObject"]});oSapSplBusyDialog.getBusyDialogInstance().close();}else{oSapSplBusyDialog.getBusyDialogInstance().close();sap.ca.ui.message.showMessageToast(oSapSplUtils.getBundle().getText("USER_DELETED_SUCCESSFULLY"));sap.ui.getCore().getModel("myContactListODataModel").refresh();}}},error:function(x,t,a){if(x){sap.ca.ui.message.showMessageBox({type:oSapSplUtils.getErrorMessagesfromErrorPayload(x.responseJSON)["messageTitle"],message:oSapSplUtils.getErrorMessagesfromErrorPayload(x.responseJSON)["errorWarningString"],details:oSapSplUtils.getErrorMessagesfromErrorPayload(x.responseJSON)["ufErrorObject"]});}oSapSplBusyDialog.getBusyDialogInstance().close();jQuery.sap.log.error(a,t,"MyContactDetails.controller.js");},complete:function(){oSapSplBusyDialog.getBusyDialogInstance().close();}});},fnHandleDeleteOfMyContacts:function(){var t=this;sap.m.MessageBox.show(oSapSplUtils.getBundle().getText("USER_DELETE_CONFIRMATION"),sap.m.MessageBox.Icon.WARNING,oSapSplUtils.getBundle().getText("WARNING"),[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.CANCEL],function(s){if(s==="YES"){t.fnDeleteUserServiceCall();}else{sap.ui.getCore().byId("MyContactsMaster--sapSplSearchMyUsersMasterList").focus();}});},fnHandleEditOfMyContacts:function(){var s=jQuery.extend(true,{},sap.ui.getCore().getModel("myContactDetailModel").getData());s["MainUserRoles_Role1"]=s["Role.description"];if(s["Role.description"]==="Driver"){s["EmailVisible"]=false;}else{s["EmailVisible"]=true;}s["ActionName"]=oSapSplUtils.getBundle().getText("NEW_CONTACT_SAVE");var S=null;if(s["canChangeRole"]&&s["canChangeRole"]===1){S=true;}else{S=false;}s["Mode"]="Edit";var b=sap.ui.getCore().getEventBus();b.publish("navInDetail","to",{from:this.getView(),data:{selectEnabled:S,sMode:"edit",context:s}});},onBeforeShow:function(e){if(e.data.context){sap.ui.getCore().getModel("myContactDetailModel").setData(e.data.context);}window.setTimeout(function(){sap.ui.getCore().byId("MyContactsMaster--sapSplSearchMyUsersMasterList").focus();},1000);},getUnifiedShellInstance:function(){return this.unifiedShell;},setUnifiedShellInstance:function(u){this.unifiedShell=u;}});
