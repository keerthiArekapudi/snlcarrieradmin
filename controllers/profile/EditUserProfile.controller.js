/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.require("splReusable.libs.SapSplAppErrorHandler");sap.ui.controller("splController.profile.EditUserProfile",{bProfileIsModified:false,oPayloadObject:{"inputHasChangeMode":true,"Header":[]},oTransientPayload:{},oUserProfileModel:{},onInit:function(){var t=this;this.getView().addEventDelegate({onAfterShow:function(){window.setTimeout(function(){t.getView().byId("sapSplMyProfileEditModeFirstNameText").focus();},100);}});},commonLiveChange:function(){if(!this.bProfileIsModified){this.bProfileIsModified=true;}},handleFirstNameChange:function(e){this.bProfileIsModified=true;oSapSplUtils.setIsDirty(this.bProfileIsModified);$.sap.log.info("SAP SCL Event","Event fired "+e,"SAPSCL");},handleLastNameChange:function(e){this.bProfileIsModified=true;oSapSplUtils.setIsDirty(this.bProfileIsModified);$.sap.log.info("SAP SCL Event","Event fired "+e,"SAPSCL");},handleSalutationChange:function(e){this.bProfileIsModified=true;oSapSplUtils.setIsDirty(this.bProfileIsModified);$.sap.log.info("SAP SCL Event","Event fired "+e,"SAPSCL");},handlePrefixChange:function(e){this.bProfileIsModified=true;oSapSplUtils.setIsDirty(this.bProfileIsModified);$.sap.log.info("SAP SCL Event","Event fired "+e,"SAPSCL");},handleTelephoneChange:function(e){this.bProfileIsModified=true;oSapSplUtils.setIsDirty(this.bProfileIsModified);$.sap.log.info("SAP SCL Event","Event fired "+e,"SAPSCL");},handleDesignationChange:function(e){this.bProfileIsModified=true;oSapSplUtils.setIsDirty(this.bProfileIsModified);$.sap.log.info("SAP SCL Event","Event fired "+e,"SAPSCL");},onAfterRendering:function(){},handleProfileBackNavigation:function(){this.goBackToCaller(0);},goBackToCaller:function(g){oSplBaseApplication.getAppInstance().back({goBackWithData:g});},handleProfileSaveButtonPressEvent:function(){var t=this;this.createBaseSkeletonPayloadObject();this.oPayloadObject.Header[0]=this.oTransientPayload;if(this.bProfileIsModified){this.constructPayloadForPost();oSapSplBusyDialog.getBusyDialogInstance({title:oSapSplUtils.getBundle().getText("BUSY_DIALOG_MESSAGE")}).open();oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getServiceMetadata("bupa",true),method:"PUT",dataType:"json",data:JSON.stringify(this.oPayloadObject),contentType:"json; charset=UTF-8",beforeSend:function(x){x.setRequestHeader("Content-Type","application/json;charset=utf-8");x.setRequestHeader("X-CSRF-Token",oSapSplUtils.getCSRFToken());},success:function(){},error:function(){},complete:function(x){oSapSplBusyDialog.getBusyDialogInstance().close();if(x.status===200){oSapSplUtils.setIsDirty(false);t.bProfileIsModified=false;sap.m.MessageToast.show(oSapSplUtils.getBundle().getText("USER_PROFILE_UPDATE_SUCCESSFUL"));t.goBackToCaller(1);}else if(x.status>=400&&x.status<500){if(x.responseJSON.hasOwnProperty("Error")){if(x.responseJSON.Error.length>0){oSapSplAppErrorHandler.show(x,true,null,function(d){jQuery.sap.log.info("SAP Connected Logistics","Dialog close Event fired "+d.m,"SAPSCL");jQuery.sap.log.error("SPL User Profile","Profile update failed. Toast rendered and closed","SAPSCL");});}}else{oSapSplAppErrorHandler.show(x,false,null,function(d){jQuery.sap.log.info("SAP Connected Logistics","Dialog close Event fired "+d.m,"SAPSCL");jQuery.sap.log.error("SPL User Profile","Profile update failed. Toast rendered and closed","SAPSCL");});}}else if(x.status>=500){oSapSplAppErrorHandler.show(x,false,null,function(d){jQuery.sap.log.info("SAP Connected Logistics","Dialog close Event fired "+d.m,"SAPSCL");jQuery.sap.log.error("SPL User Profile","Profile update failed. Toast rendered and closed","SAPSCL");});}}});}else{this.goBackToCaller(1);}},onBeforeShow:function(){},getData:function(e){var m=new sap.ui.model.json.JSONModel();m.setDefaultBindingMode(sap.ui.model.BindingMode.OneWay);m.setData(e.data.cDetails);this.byId("sapSplUserProfileEditPage").setModel(m);},handleProfileCancelButtonPressEvent:function(){this.goBackToCaller(0);},createBaseSkeletonPayloadObject:function(){this.oTransientPayload["UUID"]=sap.ui.getCore().getModel("loggedOnUserModel").getData()["profile"]["UUID"];this.oTransientPayload["BasicInfo.ID"]=oSapSplUtils.getCompanyDetails()["BasicInfo_ID"];this.oTransientPayload["BasicInfo.CompanyID"]=oSapSplUtils.getCompanyDetails()["BasicInfo_CompanyID"];this.oTransientPayload["BasicInfo.Type"]="P";this.oTransientPayload["ChangeMode"]="U";},constructPayloadForPost:function(){this.oTransientPayload["PersonName.GivenName"]=this.byId("sapSplMyProfileEditModeFirstNameText").getValue();this.oTransientPayload["PersonName.Surname"]=this.byId("sapSplMyProfileEditModeLastNameText").getValue();this.oTransientPayload["PersonName.Title"]=this.byId("sapSplMyProfileEditModeSalutationText").getValue();this.oTransientPayload["PersonName.SurnamePrefix"]=this.byId("sapSplMyProfileEditModePrefixText").getValue();this.oTransientPayload["CommunicationInfo.Phone"]=this.byId("sapSplMyProfileEditModeTelephoneText").getValue();this.oTransientPayload["PersonName.JobFunction"]=this.byId("sapSplMyProfileEditModeDesignationText").getValue();},handleEditProfileBackNavigation:function(){this.goBackToCaller(0);}});
