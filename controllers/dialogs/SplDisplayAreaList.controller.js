/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.controller("splController.dialogs.SplDisplayAreaList",{onInit:function(){var t=this;var s=sap.ui.getCore().getModel("LiveAppODataModel");this.getView().setModel(s);var S=new sap.ui.model.Sorter("isMyCompanyView",false,function(c){var o=c.getProperty("OwnerName");var i=c.getProperty("isMyCompanyView");if(i===1){return{key:"My Owner",text:"{splI18NModel>MY_COMPANY_DISPLAY_AREAS}"};}else{return{key:o,text:o};}});var d=this.getView().byId("DisplayAreaList");d.getBinding("items").sort(S);d.getBinding("items").filter([new sap.ui.model.Filter("Favourite",sap.ui.model.FilterOperator.EQ,"1")]);d.addEventDelegate({onAfterRendering:function(e){e.srcControl.setBusy(false);var a=t.getView().getViewData().oDisplayAreaLabel.getText();if(e.srcControl.getItems().length>0){if(a!==oSapSplUtils.getBundle().getText("SELECT_DISPLAY_AREA")){for(var i=0;i<e.srcControl.getItems().length;i++){if(e.srcControl.getItems()[i].getTitle()===a){e.srcControl.getItems()[i].setSelected(true);break;}}}}}});this.parentControllerInstance=this.getView().getViewData().parentControllerInstance;},handleSelectOfDisplayArea:function(e){var z={};var c=oSapSplMapsDataMarshal.convertGeoJSONToString(JSON.parse(e.getParameters().listItem.getBindingContext().getProperty().DisplayArea_Center)).split(";");z.lon=parseFloat(c[0],10);z.lat=parseFloat(c[1],10);z.zoomLevel=parseFloat(e.getParameters().listItem.getBindingContext().getProperty().DisplayArea_ZoomLevel,10);oSapSplMapsDataMarshal.fnSetZoomAndCenter(this.parentControllerInstance.byId("oSapSplLiveAppMap"),z);this.getView().getViewData().oDisplayAreaLabel.setText(e.getParameters().listItem.getTitle());},changeDefaultDisplayAreaOnCloseOfDialog:function(o){if(this.getView().getViewData().oDisplayAreaLabel.getText()!==oSapSplUtils.getBundle().getText("SELECT_DISPLAY_AREA")){var z={};var c=oSapSplMapsDataMarshal.convertGeoJSONToString(JSON.parse(o.DisplayArea_Center)).split(";");z.lon=parseFloat(c[0],10);z.lat=parseFloat(c[1],10);z.zoomLevel=parseFloat(o.DisplayArea_ZoomLevel,10);oSapSplMapsDataMarshal.fnSetZoomAndCenter(this.parentControllerInstance.byId("oSapSplLiveAppMap"),z);this.getView().getViewData().oDisplayAreaLabel.setText(o.Name);}},setBeginButton:function(b){var t=this;b.attachPress(function(){var c=sap.ui.view({viewName:"splView.dialogs.SplCreateDisplayAreaDialog",type:sap.ui.core.mvc.ViewType.XML,viewData:t.getView().getViewData()});var a=new sap.m.Dialog({title:oSapSplUtils.getBundle().getText("CREATE_VIEW"),content:c}).open().addStyleClass("sapSplDisplayAreaDialogContent");c.getController().setParentDialogInstance(a);a.attachAfterOpen(function(e){oSapSplUtils.fnSyncStyleClass(a);t.parentControllerInstance.fnBlockUnblockLiveAppUI("Block","createDisplayAreaDialog");});a.attachAfterClose(function(e){t.parentControllerInstance.fnBlockUnblockLiveAppUI("Unblock");e.getSource().destroy();t.getView().getViewData().parentControllerInstance.fnShowHideLiveAppDisplayAreaBorder("hide");});a.addEventDelegate({onAfterRendering:function(e){t.parentControllerInstance.fnHandleDialogMove(e.srcControl);}});});},setEndButton:function(b){var t=this;b.attachPress(function(){var s=sap.ui.view({viewName:"splView.dialogs.SplEditDisplayAreaSettings",type:sap.ui.core.mvc.ViewType.XML,viewData:t.getView().getViewData()});var a=new sap.m.Dialog({title:oSapSplUtils.getBundle().getText("DISPLAY_AREA_SETTINGS"),content:new sap.ui.layout.HorizontalLayout().addStyleClass("sapSplDisplayAreaSettingsDialog").addContent(s)}).open().addStyleClass("sapSplDisplayAreaDialogContent");s.getController().setParentDialogInstance(a);a.attachAfterOpen(function(){oSapSplUtils.fnSyncStyleClass(a);t.parentControllerInstance.fnPreventEnableMapRefresh("Prevent");});a.attachAfterClose(function(e){e.getSource().destroy();t.parentControllerInstance.fnPreventEnableMapRefresh("Enable");});});}});
