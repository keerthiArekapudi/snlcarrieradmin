/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.controller("splController.dialogs.SplDeleteRearrangingStopsWarningDialog",{onInit:function(){this.oViewData=this.getView().getViewData();this.oSplItemModel=new sap.ui.model.json.JSONModel();this.oSplItemModel.setData(this.oViewData);this.fnDefineControlLabelsFromLocalizationBundle();this.getView().setModel(this.oSplItemModel);this.fnDefineControlLabelsFromLocalizationBundle();},fnDefineControlLabelsFromLocalizationBundle:function(){},setParentDialogInstance:function(p){this.oParentDialogInstance=p;this.setButtonForDialog();},setButtonForDialog:function(){this.oSapSplConfirmButton=new sap.m.Button({id:"sapSplDeleteRearrangingStopsWarningDialogConfirm",press:jQuery.proxy(this.fnHandlePressOfDialogConfirm,this)});if(this.oSplItemModel.getData().dialogType==="L"){this.oSapSplConfirmButton.setText(oSapSplUtils.getBundle().getText("OK"));this.oParentDialogInstance.setEndButton(this.oSapSplConfirmButton);}else{this.oSapSplCancelButton=new sap.m.Button({id:"sapSplDeleteRearrangingStopsWarningDialogCancel",press:jQuery.proxy(this.fnHandlePressOfDialogCancel,this)});this.oSapSplConfirmButton.setText(oSapSplUtils.getBundle().getText("PROMPT_FOR_DELETION_DIALOG_TITLE"));this.oSapSplCancelButton.setText(oSapSplUtils.getBundle().getText("CANCEL"));this.oParentDialogInstance.setBeginButton(this.oSapSplConfirmButton);this.oParentDialogInstance.setEndButton(this.oSapSplCancelButton);}},fnHandlePressOfDialogConfirm:function(){var a=this.oSplItemModel.getData().Action;var m=$.extend(true,{},sap.ui.getCore().getModel("SplCreateNewTourModel").getData());var d=this.oSplItemModel.getData().dialogType;var f=this.oSplItemModel.getData().firstStopIndex;if(d==="R"){var s=this.oSplItemModel.getData().secondStopIndex;m=this.fnDeleteAffectedItemsOfStops(f,"fIndex",m,a);m=this.fnDeleteAffectedItemsOfStops(s,"sIndex",m,a);m=this.fnCorrectItemsOnStopsRearranging(f,m,s);m=this.fnCorrectItemsOnStopsRearranging(s,m,f);m=this.fnSwapStops(f,s,m);}else if(d==="D"){m=this.fnDeleteFreightItemAssignments(f,m);if(f===(m.stopsRow.length-1)){m.stopsRow[f-1].leavesTimeVisible=false;}m.stopsRow.splice(f,1);}else if(d==="L"){this.fnDropRemainingFreightItems(f,m);}sap.ui.getCore().getModel("SplCreateNewTourModel").setData(m);this.fnToCaptureLiveChangeToSetFlag();this.getView().getParent().close();},fnDropRemainingFreightItems:function(c,m){var i,I;for(I=0;I<m.Items.length;I++){if(m.Items[I].dropActionHappened==="N"&&m.Items[I].pickActionHappened==="P"){if(m.stopsRow[m.Items[I].pickStopIndex].LocationUUID!==m.stopsRow[m.stopsRow.length-1].LocationUUID){m.Items[I].dropActionHappened="D";m.Items[I].dropStopIndex=c;for(i=0;i<m.stopsRow[c].items.length;i++){if(m.Items[I].UUID===m.stopsRow[c].items[i].ItemUUID){m.stopsRow[c].items[i].Action="D";m.stopsRow[c].items[i].IsDeleted="0";m.stopsRow[c].items[i].pickup=oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ASSIGN_PICK_UP");m.stopsRow[c].items[i].drop=oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ASSIGN_DROP");this.fnToCaptureLiveChangeToSetFlag();}}}}}return m;},fnDeleteFreightItemAssignments:function(i,m){var I,k;for(I=0;I<m.Items.length;I++){if(m.Items[I].pickStopIndex===i){m.Items[I].pickStopIndex=-1;m.Items[I].pickActionHappened="N";if(m.Items[I].dropActionHappened!=="N"){for(k=0;k<m.stopsRow[m.Items[I].dropStopIndex].items.length;k++){if(m.stopsRow[m.Items[I].dropStopIndex].items[k].ItemUUID===m.Items[I].UUID){m.stopsRow[m.Items[I].dropStopIndex].items[k].IsDeleted="1";m.stopsRow[m.Items[I].dropStopIndex].items[k].Action="N";break;}}}m.Items[I].dropStopIndex=-1;m.Items[I].dropActionHappened="N";}if(m.Items[I].dropStopIndex===i){m.Items[I].dropStopIndex=-1;m.Items[I].dropActionHappened="N";for(k=0;k<m.stopsRow[m.Items[I].pickStopIndex].items.length;k++){if(m.stopsRow[m.Items[I].pickStopIndex].items[k].ItemUUID===m.Items[I].UUID){m.stopsRow[m.Items[I].pickStopIndex].items[k].IsDeleted="1";m.stopsRow[m.Items[I].pickStopIndex].items[k].Action="N";break;}}m.Items[I].pickStopIndex=-1;m.Items[I].pickActionHappened="N";}if(m.Items[I].dropStopIndex>=i+1){m.Items[I].dropStopIndex--;}if(m.Items[I].pickStopIndex>=i+1){m.Items[I].pickStopIndex--;}}return m;},fnDeleteAffectedItemsOfStops:function(s,i,m,a){var f=this.oSplItemModel.getData().AffectedFreightItems;var k,I;for(k=0;k<f.length;k++){for(I=0;I<m.Items.length;I++){if(m.Items[I].UUID===f[k].UUID){if(m.stopsRow[s].items[f[k][i]].Action===a){m.Items[I].pickActionHappened="N";m.Items[I].pickStopIndex=-1;}else{m.Items[I].dropActionHappened="N";m.Items[I].dropStopIndex=-1;}m.stopsRow[s].items[f[k][i]].Action="N";m.stopsRow[s].items[f[k][i]].isDeleted="1";break;}}}return m;},fnCorrectItemsOnStopsRearranging:function(i,m,n){var k,I;for(k=0;k<m.stopsRow[i].items.length;k++){if(m.stopsRow[i].items[k].Action!=="N"){for(I=0;I<m.Items.length;I++){if(m.Items[I].UUID===m.stopsRow[i].items[k].ItemUUID){if(m.stopsRow[i].items[k].Action==="P"){m.Items[I].pickStopIndex=n;}else{m.Items[I].dropStopIndex=n;}break;}}}}return m;},fnSwapStops:function(i,I,m){var t=m.stopsRow[i];m.stopsRow[i]=m.stopsRow[I];m.stopsRow[I]=t;var f=m.stopsRow[i].leavesTimeVisible;m.stopsRow[i].leavesTimeVisible=m.stopsRow[I].leavesTimeVisible;m.stopsRow[I].leavesTimeVisible=f;return m;},fnToCaptureLiveChangeToSetFlag:function(){if(!oSapSplUtils.getIsDirty()){oSapSplUtils.setIsDirty(true);}},fnHandlePressOfDialogCancel:function(){this.getView().getParent().close();}});
