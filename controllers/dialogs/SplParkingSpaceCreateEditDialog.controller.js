/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.require("sap.ca.ui.message.message");sap.ui.controller("splController.dialogs.SplParkingSpaceCreateEditDialog",{onInit:function(){this.navContainer=this.byId("SapSplParkingSpaceCreateEditNavContainer");this.oSapSplValueHelpForSelectCardsInput=this.byId("SapSplValueHelpForSelectCardsInput");this.oSapSplValueHelpForSelectServicesInput=this.byId("SapSplValueHelpForSelectServicesInput");this.oSapSplValueHelpForSelectFuelInput=this.byId("SapSplValueHelpForSelectFuelInput");sap.ui.getCore().setModel(new sap.ui.model.json.JSONModel(),"sapSplCreateParkingSpaceModel");this.getView().setModel(sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel"));this.byId("SapSplCardsValueHelpLayout").setModel(sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel"));this.byId("SapSplServicesValueHelpLayout").setModel(sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel"));this.byId("SapSplFuelValueHelpLayout").setModel(sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel"));this.byId("SapSplCreateParkingSpaceMultiSelectList").setModel(sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel"));this.oViewData=this.getView().getViewData();if(!this.oViewData["Parking"].results){this.oViewData["Parking"].results=[];}if(this.oViewData["mode"]==="Create"){sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").setData(this.getEmptyData(this.oViewData));if(this.oViewData["sDialogType"]==="LC0002"){this.byId("SapSplParkingSpaceCreateEditPage").setTitle(oSapSplUtils.getBundle().getText("CREATE_PARKING_SPACE_DIALOG_TITLE"));this.sName="Parking Space";this.sCategory="P";this.byId("sapSplCreateLocationEntityIDLabel").setVisible(false);this.byId("SapSplValueHelpForSelectEntitiesInput").setVisible(false);this.byId("SelectProvidersSelectControl").setVisible(false);this.byId("SelectProvidersLabel").setVisible(false);this.byId("checkBoxAutomaticManualStatusMode").setVisible(false);}else if(this.oViewData["sDialogType"]==="LC0007"){this.fetchListOfProviders();this.byId("SapSplParkingSpaceCreateEditPage").setTitle(oSapSplUtils.getBundle().getText("ADD_CONTAINER_DEPOT"));this.byId("SapSplEntitySelectListPageTitle").setText(oSapSplUtils.getBundle().getText("SELECT_CONTAINER_DEPOT_ID"));this.byId("sapSplCreateLocationEntityIDLabel").setText(oSapSplUtils.getBundle().getText("CONTAINER_DEPOT_ID"));this.sName="Container Depot";this.sCategory="D";this.byId("SapSplParkingSpaceCreateEditPageCapaity").setVisible(false);this.byId("SapSplParkingSpaceCreateEditPageCapaityText").setVisible(false);}else{this.fetchListOfProviders();this.byId("SapSplParkingSpaceCreateEditPage").setTitle(oSapSplUtils.getBundle().getText("ADD_CONTAINER_TERMINAL"));this.byId("sapSplCreateLocationEntityIDLabel").setText(oSapSplUtils.getBundle().getText("CONTAINER_TERMINAL_ID"));this.byId("SapSplEntitySelectListPageTitle").setText(oSapSplUtils.getBundle().getText("SELECT_CONTAINER_TERMINAL_ID"));this.sName="Container Terminal";this.sCategory="T";this.byId("SapSplParkingSpaceCreateEditPageCapaity").setVisible(false);this.byId("SapSplParkingSpaceCreateEditPageCapaityText").setVisible(false);}this.byId("checkBoxAutomaticManualStatusMode").setSelected(true);this.byId("checkBoxAutomaticManualStatusMode").fireSelect({selected:true});this.byId("sapSplParkingSpaceAddImage").setEnabled(false);}else{if(this.oViewData["sDialogType"]==="LC0002"){this.byId("SapSplParkingSpaceCreateEditPage").setTitle(oSapSplUtils.getBundle().getText("EDIT_PARKING_SPACE_DIALOG_TITLE"));this.sName="Parking Space";this.sCategory="P";this.byId("checkBoxAutomaticManualStatusMode").setVisible(false);}else if(this.oViewData["sDialogType"]==="LC0007"){this.byId("SapSplParkingSpaceCreateEditPage").setTitle(oSapSplUtils.getBundle().getText("EDIT_CONTAINER_DEPOT"));this.sName="Container Depot";this.sCategory="D";this.byId("SapSplParkingSpaceCreateEditPageCapaity").setVisible(false);this.byId("SapSplParkingSpaceCreateEditPageCapaityText").setVisible(false);this.byId("sapSplCreateLocationEntityIDLabel").setText(oSapSplUtils.getBundle().getText("CONTAINER_DEPOT_ID"));}else{this.byId("SapSplParkingSpaceCreateEditPage").setTitle(oSapSplUtils.getBundle().getText("EDIT_CONTAINER_TERMINAL"));this.sName="Container Terminal";this.sCategory="T";this.byId("SapSplParkingSpaceCreateEditPageCapaity").setVisible(false);this.byId("SapSplParkingSpaceCreateEditPageCapaityText").setVisible(false);this.byId("sapSplCreateLocationEntityIDLabel").setText(oSapSplUtils.getBundle().getText("CONTAINER_TERMINAL_ID"));}if(this.oViewData["ModeOfStatusUpdate"]==="M"){this.byId("checkBoxAutomaticManualStatusMode").setSelected(false);this.byId("checkBoxAutomaticManualStatusMode").fireSelect({selected:false});}else{this.byId("checkBoxAutomaticManualStatusMode").setSelected(true);this.byId("checkBoxAutomaticManualStatusMode").fireSelect({selected:true});}sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").setData(this.oViewData);if(this.oViewData["sDialogType"]==="LC0002"||!(this.oViewData["AdditionalID"]===null&&this.oViewData["StatusProvider"]===null)){this.byId("sapSplCreateLocationEntityIDLabel").setVisible(false);this.byId("SapSplValueHelpForSelectEntitiesInput").setVisible(false);this.byId("SelectProvidersSelectControl").setVisible(false);this.byId("SelectProvidersLabel").setVisible(false);}else{this.fetchListOfProviders();}if((this.oViewData["ImageUrl"].constructor===String&&this.oViewData["ImageUrl"].length===0)||!this.oViewData["ImageUrl"]){this.byId("sapSplParkingSpaceImage").setVisible(false);this.byId("sapSplParkingSpaceAddImage").setEnabled(false);}else{this.byId("sapSplParkingSpaceImage").setSrc(this.oViewData["ImageUrl"]);this.byId("sapSplParkingSpaceImage").setVisible(true);this.byId("sapSplParkingSpaceAddImage").setEnabled(true);this.byId("sapSplParkingSpaceImageURL").setValue(this.oViewData["ImageUrl"]);}if(this.oViewData["bDefaultImage"]!==undefined&&this.oViewData["bDefaultImage"]===true){this.byId("sapSplParkingSpaceImageURL").setValue("");this.byId("sapSplParkingSpaceAddImage").setEnabled(false);}}this.checkedFilter=new sap.ui.model.Filter("checked",sap.ui.model.FilterOperator.EQ,true);this.cardsFilter=new sap.ui.model.Filter("Category",sap.ui.model.FilterOperator.EQ,"C");this.servicesFilter=new sap.ui.model.Filter("Category",sap.ui.model.FilterOperator.EQ,"S");this.fuelFilter=new sap.ui.model.Filter("Category",sap.ui.model.FilterOperator.EQ,"F");this.addAllFilter=new sap.ui.model.Filter("all",sap.ui.model.FilterOperator.EQ,true);this.removeAllFilter=new sap.ui.model.Filter("all",sap.ui.model.FilterOperator.NE,true);this.byId("SapSplServicesValueHelpCell").getBinding("content").filter([this.checkedFilter,this.servicesFilter,this.removeAllFilter],true);this.byId("SapSplFuelValueHelpCell").getBinding("content").filter([this.checkedFilter,this.fuelFilter,this.removeAllFilter],true);this.byId("SapSplCardsValueHelpCell").getBinding("content").filter([this.checkedFilter,this.cardsFilter,this.removeAllFilter],true);this.fnDefineControlLabelsFromLocalizationBundle();var t=this;this.getView().addEventDelegate({onAfterRendering:function(){setTimeout(function(){t.getView().getParent().getParent().$().css("top","100px");t.getView().getParent().getParent().$().css("left","90px");},1500);if(t.byId("SapSplParkingSpaceCreateEditPageNameInput")){setTimeout(function(){t.byId("SapSplParkingSpaceCreateEditPageNameInput").focus();},1000);}}});},handleSelectOfEntityFromList:function(e){this.byId("SapSplValueHelpForSelectEntitiesInput").setValue(e.getSource().getSelectedItem().getTitle());this.byId("SapSplValueHelpForSelectEntitiesInput").setValueState("None");this.byId("SapSplValueHelpForSelectEntitiesInput").removeAllCustomData();this.byId("SapSplValueHelpForSelectEntitiesInput").addCustomData(new sap.ui.core.CustomData({key:"boundObject",value:e.getSource().getSelectedItem().getBindingContext().getProperty()}));},fetchListOfProviders:function(){var l=[];var p={terminalTypeName:"placeholder",description:oSapSplUtils.getBundle().getText("SELECT_PROVIDER_PLACEHOLDER")};var m=sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").getData();m["Providers"]=[];m["Providers"].splice(0,0,p);sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").setData(m);oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getFQServiceUrl("/sap/spl/xs/app/services/containerTerminals.xsjs"),method:"GET",async:true,json:true,success:function(d){var m=sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").getData();l=JSON.parse(d.Data);m["Providers"]=l;m["Providers"].splice(0,0,p);sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").setData(m);},error:function(e){if(e&&e["status"]===500){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["status"]+"\t"+e.statusText,details:e.responseText}).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getBundle().getText("INCORRECT_ARGUMENTS_ERROR_MESSAGE"),details:oSapSplUtils.getErrorMessagesfromErrorPayload(JSON.parse(e.responseText))["ufErrorObject"]}).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}}});},handleSelectOfAutomaticManualStatusMode:function(e){if(e.getParameters().selected===false){this.byId("SelectProvidersSelectControl").setEnabled(false);this.byId("SelectProvidersSelectControl").setSelectedKey(null);this.byId("SapSplValueHelpForSelectEntitiesInput").setEnabled(false);this.byId("SapSplValueHelpForSelectEntitiesInput").removeAllCustomData();this.byId("SapSplValueHelpForSelectEntitiesInput").setValue("");this.byId("SapSplValueHelpForSelectEntitiesInput").setValueState("None");}else{this.byId("SelectProvidersSelectControl").setEnabled(true);if(this.byId("SelectProvidersSelectControl").getSelectedKey()!==""&&this.byId("SelectProvidersSelectControl").getSelectedKey()!=="placeholder"){this.byId("SapSplValueHelpForSelectEntitiesInput").setEnabled(true);}else{this.byId("SapSplValueHelpForSelectEntitiesInput").setEnabled(false);}}oSapSplUtils.setIsDirty(true);},handleSelectOfEntityServiceProvider:function(e){var m=sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").getData();var l=[],p=null,t=this;if(e.getParameters().selectedItem.getKey()==="placeholder"){this.byId("SapSplValueHelpForSelectEntitiesInput").setEnabled(false);}else{oSapSplUtils.setIsDirty(true);e.getSource().removeStyleClass("errorBorderStyle");p=JSON.stringify({terminalType:e.getParameters().selectedItem.getKey()});oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getFQServiceUrl("/sap/spl/xs/app/services/containerTerminalList.xsjs"),method:"POST",data:p,async:true,json:true,success:function(d){l=JSON.parse(d.Data);m["Entities"]=l;t.byId("SapSplValueHelpForSelectEntitiesInput").setEnabled(true);sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").setData(m);},error:function(a){if(a&&a["status"]===500){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:a["status"]+"\t"+a.statusText,details:a.responseText}).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getBundle().getText("INCORRECT_ARGUMENTS_ERROR_MESSAGE"),details:oSapSplUtils.getErrorMessagesfromErrorPayload(JSON.parse(a.responseText))["ufErrorObject"]}).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}}});}},handleAddParkingSpacePhoto:function(){this.byId("sapSplParkingSpaceImage").setSrc(this.byId("sapSplParkingSpaceImageURL").getValue());this.byId("sapSplParkingSpaceImage").setVisible(true);window.setTimeout(function(){document.getElementsByClassName("SapSplParkingSpaceCreateEditTimingsPlaceHolder")[0].scrollIntoView();},500);},getEmptyData:function(v){return{Name:"",PhoneNumber:"",Capacity:"",Website:"",ImageUrl:"",Timings:"",Providers:[],BuildingID:"",StreetName:"",CityName:"",StreetPostalCode:"",RegionName:"",CountryName:"",AdditionalInformation:"",Latitude:v["Latitude"],Longitude:v["Longitude"],Parking:v["Parking"],ReportedStatus:null,AdditionalID:null,StatusProvider:null,ModeOfStatusUpdate:"A"};},fnHandleClickOfDeleteSelectedItem:function(e){var b=e.getSource().getBindingContext().sPath.split("/");var m=sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").getData();m[b[1]][b[2]][b[3]]["checked"]=false;sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").setData(m);this.byId("SapSplServicesValueHelpCell").getBinding("content").filter([this.checkedFilter,this.servicesFilter,this.removeAllFilter],true);this.byId("SapSplFuelValueHelpCell").getBinding("content").filter([this.checkedFilter,this.fuelFilter,this.removeAllFilter],true);this.byId("SapSplCardsValueHelpCell").getBinding("content").filter([this.checkedFilter,this.cardsFilter,this.removeAllFilter],true);},handleFacilitySelect:function(e){if(e.getParameters().listItem.getBindingContext().getProperty().Name==="Select all"){for(var i=0;i<e.getSource().getItems().length;i++){e.getSource().getItems()[i].setSelected(e.getParameters().listItem.getBindingContext().getProperty().checked);}}},fnIsAllMandatoryFieldsFilled:function(){var r=true;if(this.byId("SapSplParkingSpaceCreateEditPageAddressBuildingIDInput").getValue().length===0){this.byId("SapSplParkingSpaceCreateEditPageAddressBuildingIDInput").setValueStateText(oSapSplUtils.getBundle().getText("EMPTY_ERROR_MESSAGE"));this.byId("SapSplParkingSpaceCreateEditPageAddressBuildingIDInput").setValueState("Error");r=false;}else{this.byId("SapSplParkingSpaceCreateEditPageAddressBuildingIDInput").setValueState("None");}if(this.byId("SapSplParkingSpaceCreateEditPageAddressStreetNameInput").getVisible()===true&&this.byId("SapSplParkingSpaceCreateEditPageAddressStreetNameInput").getValue().length===0){this.byId("SapSplParkingSpaceCreateEditPageAddressStreetNameInput").setValueStateText(oSapSplUtils.getBundle().getText("EMPTY_ERROR_MESSAGE"));this.byId("SapSplParkingSpaceCreateEditPageAddressStreetNameInput").setValueState("Error");r=false;}else{this.byId("SapSplParkingSpaceCreateEditPageAddressStreetNameInput").setValueState("None");}if(this.byId("SapSplParkingSpaceCreateEditPageAddressCityNameInput").getVisible()===true&&this.byId("SapSplParkingSpaceCreateEditPageAddressCityNameInput").getValue().length===0){this.byId("SapSplParkingSpaceCreateEditPageAddressCityNameInput").setValueStateText(oSapSplUtils.getBundle().getText("EMPTY_ERROR_MESSAGE"));this.byId("SapSplParkingSpaceCreateEditPageAddressCityNameInput").setValueState("Error");r=false;}else{this.byId("SapSplParkingSpaceCreateEditPageAddressCityNameInput").setValueState("None");}if(this.byId("SapSplParkingSpaceCreateEditPageAddressRegionCodeInput").getVisible()===true&&this.byId("SapSplParkingSpaceCreateEditPageAddressRegionCodeInput").getValue().length===0){this.byId("SapSplParkingSpaceCreateEditPageAddressRegionCodeInput").setValueStateText(oSapSplUtils.getBundle().getText("EMPTY_ERROR_MESSAGE"));this.byId("SapSplParkingSpaceCreateEditPageAddressRegionCodeInput").setValueState("Error");r=false;}else{this.byId("SapSplParkingSpaceCreateEditPageAddressRegionCodeInput").setValueState("None");}if(this.byId("SapSplParkingSpaceCreateEditPageAddressCountryCodeInput").getVisible()===true&&this.byId("SapSplParkingSpaceCreateEditPageAddressCountryCodeInput").getValue().length===0){this.byId("SapSplParkingSpaceCreateEditPageAddressCountryCodeInput").setValueStateText(oSapSplUtils.getBundle().getText("EMPTY_ERROR_MESSAGE"));this.byId("SapSplParkingSpaceCreateEditPageAddressCountryCodeInput").setValueState("Error");r=false;}else{this.byId("SapSplParkingSpaceCreateEditPageAddressCountryCodeInput").setValueState("None");}if(this.byId("SapSplParkingSpaceCreateEditPageAddressPostalCodeInput").getVisible()===true&&this.byId("SapSplParkingSpaceCreateEditPageAddressPostalCodeInput").getValue().length===0){this.byId("SapSplParkingSpaceCreateEditPageAddressPostalCodeInput").setValueStateText(oSapSplUtils.getBundle().getText("EMPTY_ERROR_MESSAGE"));this.byId("SapSplParkingSpaceCreateEditPageAddressPostalCodeInput").setValueState("Error");r=false;}else{this.byId("SapSplParkingSpaceCreateEditPageAddressPostalCodeInput").setValueState("None");}if(this.byId("SapSplParkingSpaceCreateEditPageNameInput").getValue().length===0){this.byId("SapSplParkingSpaceCreateEditPageNameInput").setValueStateText(oSapSplUtils.getBundle().getText("EMPTY_ERROR_MESSAGE"));this.byId("SapSplParkingSpaceCreateEditPageNameInput").setValueState("Error");r=false;}else{this.byId("SapSplParkingSpaceCreateEditPageNameInput").setValueState("None");}if(this.sCategory!=="P"&&(this.byId("checkBoxAutomaticManualStatusMode").getSelected()===true)){if(this.byId("SapSplValueHelpForSelectEntitiesInput").getVisible()&&this.byId("SapSplValueHelpForSelectEntitiesInput").getValue().length===0){this.byId("SapSplValueHelpForSelectEntitiesInput").setValueStateText(oSapSplUtils.getBundle().getText("EMPTY_ERROR_MESSAGE"));this.byId("SapSplValueHelpForSelectEntitiesInput").setValueState("Error");r=false;}else{this.byId("SapSplValueHelpForSelectEntitiesInput").setValueState("None");}if(this.byId("SelectProvidersSelectControl").getVisible()&&this.byId("SelectProvidersSelectControl").getSelectedKey()==="placeholder"){this.byId("SelectProvidersSelectControl").addStyleClass("errorBorderStyle");r=false;}else{this.byId("SelectProvidersSelectControl").removeStyleClass("errorBorderStyle");}}else{this.byId("SapSplValueHelpForSelectEntitiesInput").setValueState("None");this.byId("SelectProvidersSelectControl").removeStyleClass("errorBorderStyle");}return r;},fnValueHelpForSelectEntityIDInCreateEditPage:function(){this.oLeftButtonInstance.setText(oSapSplUtils.getBundle().getText("OK"));var n=this.navContainer.getPages()[1].sId;this.navContainer.to(n,"slide");},fnValueHelpForSelectInParkingSpaceCreateEditPage:function(e){this.oRightButtonInstance.removeAllCustomData();this.oRightButtonInstance.addCustomData(new sap.ui.core.CustomData({key:"cancelButton",value:{id:"Back"}}));this.oLeftButtonInstance.setText(oSapSplUtils.getBundle().getText("OK"));var m=this.getView().getModel().getData();var p=m["Parking"]["results"];for(var i=0;i<p.length;i++){p[i]["checked"]=false;p[i]["all"]=false;}var t=p[0];if(t["Name"]!=="Select all"){p[0]={Name:"Select all",checked:false,all:true};p[p.length]=t;}else{t["all"]=true;}var f=this.byId("SapSplFuelValueHelpLayout").getRows()[0].getCells()[0].getContent();var c=this.byId("SapSplCardsValueHelpLayout").getRows()[0].getCells()[0].getContent();var s=this.byId("SapSplServicesValueHelpLayout").getRows()[0].getCells()[0].getContent();for(var x=0;x<f.length;x++){for(var y=0;y<p.length;y++){if(f[x].getContent()[0].getText()===p[y]["Name"]){p[y]["checked"]=true;}}}for(var a=0;a<c.length;a++){for(var b=0;b<p.length;b++){if(c[a].getContent()[0].getText()===p[b]["Name"]){p[b]["checked"]=true;}}}for(var d=0;d<s.length;d++){for(var g=0;g<p.length;g++){if(s[d].getContent()[0].getText()===p[g]["Name"]){p[g]["checked"]=true;}}}m["Parking"]["results"]=p;this.getView().getModel().setData(m);var I=e.getParameter("id");var n=this.navContainer.getPages()[1].sId;this.navContainer.to(n,"slide");if(I.indexOf("Cards")!==-1){this.byId("SapSplMultiSelectListPageTitle").setText(oSapSplUtils.getBundle().getText("CREATE_PARKING_SPACE_DIALOG_SELECT_CARDS"));this.byId("SapSplCreateParkingSpaceMultiSelectList").getBinding("items").filter(new sap.ui.model.Filter([this.addAllFilter,this.cardsFilter],false));this.facilityType="C";}else if(I.indexOf("Services")!==-1){this.byId("SapSplMultiSelectListPageTitle").setText(oSapSplUtils.getBundle().getText("CREATE_PARKING_SPACE_DIALOG_SELECT_SERVICES"));this.byId("SapSplCreateParkingSpaceMultiSelectList").getBinding("items").filter(new sap.ui.model.Filter([this.addAllFilter,this.servicesFilter],false));this.facilityType="S";}else{this.byId("SapSplMultiSelectListPageTitle").setText(oSapSplUtils.getBundle().getText("CREATE_PARKING_SPACE_DIALOG_SELECT_FUEL"));this.byId("SapSplCreateParkingSpaceMultiSelectList").getBinding("items").filter(new sap.ui.model.Filter([this.addAllFilter,this.fuelFilter],false));this.facilityType="F";}if(!this.tempModelData){this.tempModelData=jQuery.extend(true,[],sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").getData().Parking.results);}},preparePayloadForPost:function(m,v){var p={},h={},a={},g="",l="",M=(this.byId("checkBoxAutomaticManualStatusMode").getSelected()===true)?"A":"M",s=m["StatusProvider"],r=m["ReportedStatus"],A=m["AdditionalID"];if(this.sCategory!=="P"){if(A===null||A===undefined){if(this.byId("SapSplValueHelpForSelectEntitiesInput").getCustomData().length!==0){A=this.byId("SapSplValueHelpForSelectEntitiesInput").getCustomData()[0].getValue()["terminalId"];}}if(s===null||s===undefined){if(this.byId("SelectProvidersSelectControl").getSelectedKey()!=="placeholder"){s=this.byId("SelectProvidersSelectControl").getSelectedItem().getText();}}}else{M=null;}p["Header"]=[];p["Facility"]=[];p["FacilityTexts"]=[];p["Texts"]=[];p["Address"]=[];if(!v["LocationID"]){l=oSapSplUtils.getUUID();}else{l=v["LocationID"];}g=v["Longitude"]+";"+v["Latitude"]+";"+"0.0";h["LocationID"]=l;h["Name"]=m["Name"];h["OwnerID"]=oSapSplUtils.getCompanyDetails()["BasicInfo_CompanyID"];h["Type"]="L00001";h["Geometry"]=oSapSplMapsDataMarshal.convertStringToGeoJSON(g);h["ParentLocationID"]=null;h["Stacked"]="0";h["isPublic"]="1";h["isDeleted"]="0";h["ImageUrl"]=this.byId("sapSplParkingSpaceImageURL").getValue();h["Website"]=m["Website"];h["WebcamUrl"]=m["WebcamUrl"];h["PhoneNumber"]=m["PhoneNumber"];h["AdditionalInformation"]=m["AdditionalInformation"];p["Header"].push(h);if(!m["AddressUUID"]){a["UUID"]=oSapSplUtils.getUUID();}else{a["UUID"]=m["AddressUUID"];}a["LocationID"]=l;a["BuildingID"]=m["BuildingID"];a["StreetName"]=m["StreetName"];a["CityName"]=m["CityName"];a["StreetPostalCode"]=m["StreetPostalCode"];a["RegionName"]=m["RegionName"];a["CountryName"]=m["CountryName"];p["Address"].push(a);var P=null,c=null;P=m["FacilityUUID"];var b={};if(P){b["UUID"]=P;}else{b["UUID"]=oSapSplUtils.getUUID();}b["LocationID"]=l;b["Name"]=this.sName;b["Category"]=this.sCategory;var E=/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+[0-9a-z]+$/i;if(m["Capacity"]!==null&&m["Capacity"]!==undefined&&!m["Capacity"].toString().match(E)){if(!isNaN(parseInt(m["Capacity"],10))){c=parseInt(m["Capacity"],10);}else{c=m["Capacity"];if(c.length===0){c=null;}}}else{c=m["Capacity"];}b["Capacity"]=c;b["ImageUrl"]="";b["Website"]=null;b["isDeleted"]="0";b["ModeOfStatusUpdate"]=M;b["StatusProvider"]=s;b["AdditionalID"]=A;p["Facility"].push(b);for(var j=0;j<p["Facility"].length;j++){var f={};f["ObjectUUID"]=p["Facility"][j]["UUID"];f["Type"]="F";f["LocaleLanguage"]=sap.ui.getCore().getConfiguration().getLanguage();f["LocationID"]=l;f["Text"]="Services";p["FacilityTexts"].push(f);}var t={ObjectUUID:l,Type:"W",LocaleLanguage:sap.ui.getCore().getConfiguration().getLanguage(),LocationID:l,Text:m["Timings"]};var T={ObjectUUID:l,Type:"T",LocaleLanguage:sap.ui.getCore().getConfiguration().getLanguage(),LocationID:l,Text:this.oViewData["sDialogType"]};p["Texts"].push(t);p["Texts"].push(T);if(this.sCategory!=="P"){if(r===null||(m["ModeOfStatusUpdate"]!==M)){if(M==="M"){r="6";}else{r="8";}}this.oPayLoadForDefaultStatus={"FacilityAvailability":[{"FacilityUUID":b["UUID"],"ReportedStatus":r}]};}else{this.oPayLoadForDefaultStatus=null;}return p;},fnhandlePressOfOKInEntitySelectionPage:function(){var n=this.navContainer.getPages()[0].sId;this.navContainer.to(n,"slide");this.oRightButtonInstance.removeAllCustomData();this.oLeftButtonInstance.setText(oSapSplUtils.getBundle().getText("NEW_CONTACT_SAVE"));},fnSetDefaultStatus:function(p){oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getServiceMetadata("parkingSpaceStatus",true),method:"PUT",data:JSON.stringify(p),success:function(){},error:function(){jQuery.sap.log.error("fnHandleChangeOfParkingSpaceStatus","Failure of function call","liveApp.controller.js");}});},setLeftButton:function(l){if(l){var t=this;this.oLeftButtonInstance=l;l.attachPress(function(e){if(e.getSource().getText()===oSapSplUtils.getBundle().getText("NEW_CONTACT_SAVE")){var T="PUT";if(t.oViewData["mode"]&&t.oViewData["mode"]==="Create"){T="POST";}if(t.fnIsAllMandatoryFieldsFilled()){var m=sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").getData();var p=t.preparePayloadForPost(m,t.oViewData);oSapSplBusyDialog.getBusyDialogInstance().open();oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getServiceMetadata("newLocation",true),method:T,data:JSON.stringify(p),success:function(d,s,a){oSapSplBusyDialog.getBusyDialogInstance().close();if(d.constructor===String){d=JSON.parse(d);}if(a["status"]===200&&d["Error"].length===0){if(d&&d.Header&&d.Header[0]){t.oMapToolbar.getParent().getParent().getParent().getController().newCreatedVisualObject=d.Header[0].LocationID;}else{t.oMapToolbar.newCreatedVisualObject=null;}var M=sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").getData()["mode"];if(t.oPayLoadForDefaultStatus){t.fnSetDefaultStatus(t.oPayLoadForDefaultStatus);}if(M&&M==="Edit"){sap.ca.ui.message.showMessageToast(oSapSplUtils.getBundle().getText("CHANGES_SAVED_SUCCESS"));}else{sap.ca.ui.message.showMessageToast(oSapSplUtils.getBundle().getText("LOCATION_SAVED_SUCCESSFULLY"));}t.getView().getParent().getParent().close();}else{var b=oSapSplUtils.getErrorMessagesfromErrorPayload(d)["ufErrorObject"];sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getErrorMessagesfromErrorPayload(d)["errorWarningString"],details:b},jQuery.proxy(t.fireCancelAction,t)).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}},error:function(a){oSapSplBusyDialog.getBusyDialogInstance().close();oSapSplBusyDialog.getBusyDialogInstance().close();if(a&&a["status"]===500){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:a["status"]+" "+a.statusText,details:a.responseText}).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getErrorMessagesfromErrorPayload(JSON.parse(a.responseText))["errorWarningString"],details:oSapSplUtils.getErrorMessagesfromErrorPayload(JSON.parse(a.responseText))["ufErrorObject"]}).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}},complete:function(){}});}}else{t.fnhandlePressOfOKInEntitySelectionPage();}});}},setToolbarInstance:function(m){this.oMapToolbar=m;},setRightButton:function(r){if(r){this.oRightButtonInstance=r;this.oRightButtonInstance.removeAllCustomData();this.oRightButtonInstance.addCustomData(new sap.ui.core.CustomData({key:"cancelButton",value:{id:"Cancel"}}));var t=this;r.attachPress(function(e){var d=jQuery.extend(true,{},e);if(t.navContainer.getCurrentPage().sId.search("sapSplSelectedProviderEntities")!==-1){t.fnhandlePressOfOKInEntitySelectionPage();}else{if(oSapSplUtils.getIsDirty()){sap.m.MessageBox.show(oSapSplUtils.getBundle().getText("DATA_LOSS_WARNING_TEXT"),sap.m.MessageBox.Icon.WARNING,oSapSplUtils.getBundle().getText("WARNING"),[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.CANCEL],function(s){if(s==="YES"){d.getSource().getParent().close();oSapSplMapsDataMarshal.fnChangeCursor("Normal");oSapSplUtils.setIsDirty(false);}else{jQuery(".sapMDialogBlockLayerInit").addClass("sapSplHideDialogBlockerForVBMap");}},null,oSapSplUtils.fnSyncStyleClass("messageBox"));}else{d.getSource().getParent().close();oSapSplMapsDataMarshal.fnChangeCursor("Normal");}}});}},fnHandlePressOfButtonWithSelection:function(a){var n=this.navContainer.getPages()[0].sId;var e={};e.mParameters={};e.mParameters.query="";this.fnSearchOfFacilities(e);this.navContainer.to(n,"slide");if(a&&a===true){this.byId("SapSplServicesValueHelpCell").getBinding("content").filter([this.checkedFilter,this.servicesFilter,this.removeAllFilter],true);this.byId("SapSplFuelValueHelpCell").getBinding("content").filter([this.checkedFilter,this.fuelFilter,this.removeAllFilter],true);this.byId("SapSplCardsValueHelpCell").getBinding("content").filter([this.checkedFilter,this.cardsFilter,this.removeAllFilter],true);}this.oRightButtonInstance.removeAllCustomData();this.oRightButtonInstance.addCustomData(new sap.ui.core.CustomData({key:"cancelButton",value:{id:"Cancel"}}));this.oLeftButtonInstance.setText("Save");window.setTimeout(function(){if(document.getElementsByClassName("sapSplValueHelp")[2]){document.getElementsByClassName("sapSplValueHelp")[2].scrollIntoView();}},500);},sapSplChangeDirtyFlag:function(e){oSapSplUtils.setIsDirty(true);if(e.getSource().getValue().length>0){e.getSource().setValueState("None");}},fnHandleLiveChangeOfImageURL:function(e){if(e.getParameter("newValue")===""){this.byId("sapSplParkingSpaceAddImage").setEnabled(false);}else{this.byId("sapSplParkingSpaceAddImage").setEnabled(true);}oSapSplUtils.setIsDirty(true);},fnDefineControlLabelsFromLocalizationBundle:function(){this.byId("SapSplParkingSpaceCreateEditPageName").setText(oSapSplUtils.getBundle().getText("INCIDENTS_NAME"));this.byId("SapSplParkingSpaceCreateEditPageAddress").setText(oSapSplUtils.getBundle().getText("CO_ORDINATES"));this.byId("SapSplParkingSpaceCreateEditPageCapaity").setText(oSapSplUtils.getBundle().getText("CAPACITY_PARKING_SPACE_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageWebsite").setText(oSapSplUtils.getBundle().getText("WEBSITE_PARKING_SPACE_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageTimings").setText(oSapSplUtils.getBundle().getText("TIMINGS_PARKING_SPACE_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageAddPhoto").setText(oSapSplUtils.getBundle().getText("ADD_PHOTO_PARKING_SPACE_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageCards").setText(oSapSplUtils.getBundle().getText("CARDS_PARKING_SPACE_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageServices").setText(oSapSplUtils.getBundle().getText("SERVICES_PARKING_SPACE_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageFuel").setText(oSapSplUtils.getBundle().getText("FUEL_PARKING_SPACE_LABEL"));this.byId("SapSplParkingSpaceCreateEditPagePhoneNumber").setText(oSapSplUtils.getBundle().getText("BP_REGISTRATION_TABLE_COLUMN_PHONE"));this.byId("SapSplCreateParkingSpaceMultiSelectList").setNoDataText(oSapSplUtils.getBundle().getText("NO_DATA_TEXT"));this.byId("SapSplParkingSpaceCreateEditPagePhoneNumberInput").setPlaceholder(oSapSplUtils.getBundle().getText("PHONE_NUMBER_PLACEHOLDER",["+","+","+"]));this.byId("SapSplParkingSpaceCreateEditPageAddressBuildingID").setText(oSapSplUtils.getBundle().getText("HOUSE_NUMBER"));this.byId("SapSplParkingSpaceCreateEditPageAddressStreetName").setText(oSapSplUtils.getBundle().getText("STREET_NAME"));this.byId("SapSplParkingSpaceCreateEditPageAddressCityName").setText(oSapSplUtils.getBundle().getText("NEW_LOCATION_CITY_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageAddressPostalCode").setText(oSapSplUtils.getBundle().getText("NEW_LOCATION_ZIPCODE_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageAddressRegionCode").setText(oSapSplUtils.getBundle().getText("NEW_LOCATION_COUNRTY_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageAddressCountryCode").setText(oSapSplUtils.getBundle().getText("NEW_LOCATION_REGION_LABEL"));this.byId("SapSplParkingSpaceCreateEditPageWebcamURL").setText(oSapSplUtils.getBundle().getText("WEBCAM_URL_LABEL"));this.byId("sapSplParkingSpaceAddImage").setText(oSapSplUtils.getBundle().getText("REFRESH_PHOTO"));},fnSearchOfFacilities:function(e){var s=e.mParameters.query;var S,p,i,m,I;S=this.getView().byId("SapSplCreateParkingSpaceMultiSelectList");if(s.length>2){if(this.facilityType==="C"){p=this.prepareSearchPayload(s,"C");this.callSearchService(p,"C");}else if(this.facilityType==="S"){p=this.prepareSearchPayload(s,"S");this.callSearchService(p,"S");}else if(this.facilityType==="F"){p=this.prepareSearchPayload(s,"F");this.callSearchService(p,"F");}}else if(S.getBinding("items")!==undefined){m=jQuery.extend(true,{},sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").getData());for(i=0;i<m.Parking.results.length;i++){for(I=1;I<this.tempModelData.length;I++){if(m.Parking.results[i].Name===this.tempModelData[I].Name){this.tempModelData[I]=jQuery.extend(true,{},m.Parking.results[i]);}}}m.Parking.results=this.tempModelData;this.byId("SapSplCreateParkingSpaceMultiSelectList").removeSelections();m.Parking.results[0].checked=false;sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").setData(m);this.byId("SapSplCreateParkingSpaceMultiSelectList").setModel(sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel"));if(this.facilityType==="C"){this.byId("SapSplCreateParkingSpaceMultiSelectList").getBinding("items").filter(new sap.ui.model.Filter([this.addAllFilter,this.cardsFilter],false));}else if(this.facilityType==="S"){this.byId("SapSplCreateParkingSpaceMultiSelectList").getBinding("items").filter(new sap.ui.model.Filter([this.addAllFilter,this.servicesFilter],false));}else{this.byId("SapSplCreateParkingSpaceMultiSelectList").getBinding("items").filter(new sap.ui.model.Filter([this.addAllFilter,this.fuelFilter],false));}}},fnSearchOfTerminalIDs:function(e){var s=e.getParameters().query;if(s.length===0){this.byId("SapSplCreateParkingSpaceEntityelectList").getBinding("items").filter([]);}else{var f=new sap.ui.model.Filter("terminalId",sap.ui.model.FilterOperator.Contains,s);this.byId("SapSplCreateParkingSpaceEntityelectList").getBinding("items").filter([f]);}},prepareSearchPayload:function(s,p){var a={};a.UserID=oSapSplUtils.getLoggedOnUserDetails().userId;a.ObjectType="LocationFacility";a.AdditionalCriteria={};if(p==="C"){a.AdditionalCriteria.Category="C";}if(p==="F"){a.AdditionalCriteria.Category="F";}if(p==="S"){a.AdditionalCriteria.Category="S";}a.SearchTerm=s;a.FuzzinessThershold=0.3;a.MaximumNumberOfRecords=50;a.ProvideDetails=true;a.SearchInNetwork=true;return a;},callSearchService:function(p){var t=[],i,I,a=this,b={};var m=jQuery.extend(true,{},sap.ui.getCore().getModel("sapSplCreateParkingSpaceModel").getData());oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getFQServiceUrl("/sap/spl/xs/app/services/Search.xsjs"),method:"POST",async:false,data:JSON.stringify(p),success:function(d,s,c){oSapSplBusyDialog.getBusyDialogInstance().close();if(d.constructor===String){d=JSON.parse(d);}if(c["status"]===200){if(d.length>0){for(i=0;i<d.length;i++){t.push(d[i].Details);}for(i=0;i<t.length;i++){for(I=1;I<a.tempModelData.length;I++){if(t[i].Name===a.tempModelData[I].Name){t[i]=jQuery.extend(true,{},a.tempModelData[I]);break;}}}for(i=1;i<a.tempModelData.length;i++){for(I=0;I<m.Parking.results.length;I++){if(m.Parking.results[i].Name===a.tempModelData[I].Name){a.tempModelData[i]=jQuery.extend(true,{},m.Parking.results[I]);break;}}}}else{t=[];}b.results=t;m.Parking=b;a.byId("SapSplCreateParkingSpaceMultiSelectList").removeSelections();a.byId("SapSplCreateParkingSpaceMultiSelectList").getModel().setData(m);}else if(d["Error"]&&d["Error"].length>0){b.results=t;m.Parking=b;a.byId("SapSplCreateParkingSpaceMultiSelectList").removeSelections();a.byId("SapSplCreateParkingSpaceMultiSelectList").getModel().setData(m);var e=oSapSplUtils.getErrorMessagesfromErrorPayload(d)["ufErrorObject"];sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getErrorMessagesfromErrorPayload(d)["errorWarningString"],details:e}).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}},error:function(e){oSapSplBusyDialog.getBusyDialogInstance().close();b.results=[];m.Parking=b;a.byId("SapSplCreateParkingSpaceMultiSelectList").getModel().setData(m);if(e&&e["status"]===500){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["status"]+"\t"+e.statusText,details:e.responseText}).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getBundle().getText("INCORRECT_ARGUMENTS_ERROR_MESSAGE"),details:oSapSplUtils.getErrorMessagesfromErrorPayload(JSON.parse(e.responseText))["ufErrorObject"]}).attachAfterClose(function(){jQuery(".sapUiBLy").css("z-index","0");});}},complete:function(){}});}});
