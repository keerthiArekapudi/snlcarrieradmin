/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.controller("splController.dialogs.SplAssignFreightItemsDialog",{onInit:function(){this.oViewData=this.getView().getViewData();this.oSplNewLocationItemModel=new sap.ui.model.json.JSONModel();this.oSplNewLocationItemModel.setData(this.oViewData);this.fnDefineLocalizationForActionButtons();this.getView().setModel(this.oSplNewLocationItemModel);this.fnDefineControlLabelsFromLocalizationBundle();},fnDefineLocalizationForActionButtons:function(){var m=this.oSplNewLocationItemModel.getData();var l={"donothing":oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ASSIGN_DO_NOTHING"),"pickup":oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ASSIGN_PICK_UP"),"drop":oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ASSIGN_DROP")};m["labels"]=l;this.oSplNewLocationItemModel.setData(m);},fnDefineControlLabelsFromLocalizationBundle:function(){this.byId("SapSplAssignFreightItemsTable").setNoDataText(oSapSplUtils.getBundle().getText("NO_DATA_TEXT"));this.byId("SapSplAssignFreightItemsTableColumnHeader_Action").setText(oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ACTION_LABEL"));this.byId("SapSplAssignFreightItemsTableColumnHeader_OrderID").setText(oSapSplUtils.getBundle().getText("Order ID"));this.byId("SapSplAssignFreightItemsTableColumnHeader_DestinationDescription").setText(oSapSplUtils.getBundle().getText("Destination description"));},onAfterRendering:function(){},setParentDialogInstance:function(p){this.oParentDialogInstance=p;this.setButtonForDialog();},setButtonForDialog:function(){this.oSapSplNewLocationCancelButton=new sap.m.Button({press:jQuery.proxy(this.fnHandlePressOfNewLocationDialogCancel,this)});this.oSapSplNewLocationCancelButton.setText(oSapSplUtils.getBundle().getText("CLOSE"));this.oParentDialogInstance.setEndButton(this.oSapSplNewLocationCancelButton);},fnHandlePressOfNewLocationDialogCancel:function(){var m=sap.ui.getCore().getModel("SplCreateNewTourModel").getData();var a=this.oSplNewLocationItemModel.getData().rowIndex;var b,s;for(var i=0;i<m.stopsRow[a].items.length;i++){b=m.stopsRow[a].items[i].Action;s=m.stopsRow[a].items[i].IsDeleted;m.stopsRow[a].items[i]=this.oSplNewLocationItemModel.getData().fItems[i];m.stopsRow[a].items[i].Action=b;m.stopsRow[a].items[i].IsDeleted=s;m.stopsRow[a].items[i].pickup=oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ASSIGN_PICK_UP");m.stopsRow[a].items[i].drop=oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ASSIGN_DROP");m.stopsRow[a].items[i]["delete"]=oSapSplUtils.getBundle().getText("DELETE");}m.stopsRow[a].items=this.oSplNewLocationItemModel.getData().fItems;sap.ui.getCore().getModel("SplCreateNewTourModel").setData(m);this.getView().getParent().close();this.getView().getParent().destroy();},fnToCaptureLiveChangeToSetFlag:function(){if(!oSapSplUtils.getIsDirty()){oSapSplUtils.setIsDirty(true);}},fnhandelPressOfActionButton:function(e){var i=parseInt(e.getSource().getBindingContext().sPath.split("/")[2],10);var m=sap.ui.getCore().getModel("SplCreateNewTourModel").getData();var c=this.oSplNewLocationItemModel.getData();var a="",f,I,s;if(e.getSource().sId.indexOf("SapSplAssignFreightItemsTableButton_1")>0){a="N";s="0";}else if(e.getSource().sId.indexOf("SapSplAssignFreightItemsTableButton_2")>0){a="P";s="0";}else if(e.getSource().sId.indexOf("SapSplAssignFreightItemsTableButton_3")>0){a="D";s="0";}if(a!==""){m.stopsRow[c.rowIndex].items[i].Action=a;m.stopsRow[c.rowIndex].items[i].IsDeleted=s;m.stopsRow[c.rowIndex].items[i].pickup=oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ASSIGN_PICK_UP");m.stopsRow[c.rowIndex].items[i].drop=oSapSplUtils.getBundle().getText("FREIGHT_ITEM_ASSIGN_DROP");m.stopsRow[c.rowIndex].items[i]["delete"]=oSapSplUtils.getBundle().getText("DELETE");for(I=0;I<m.Items.length;I++){if(m.stopsRow[c.rowIndex].items[i].ItemUUID===m.Items[I].UUID){if(a==="P"){m.Items[I].pickActionHappened=a;m.Items[I].pickStopIndex=c.rowIndex;if(m.Items[I].dropStopIndex===c.rowIndex){m.Items[I].dropActionHappened="N";m.Items[I].dropStopIndex=-1;}}else if(a==="D"){m.Items[I].dropActionHappened=a;m.Items[I].dropStopIndex=c.rowIndex;if(m.Items[I].pickStopIndex===c.rowIndex){m.Items[I].pickActionHappened="N";m.Items[I].pickStopIndex=-1;}}else{if(m.Items[I].pickStopIndex===c.rowIndex){m.Items[I].pickActionHappened="N";m.Items[I].pickStopIndex=-1;}else if(m.Items[I].dropStopIndex===c.rowIndex){m.Items[I].dropActionHappened="N";m.Items[I].dropStopIndex=-1;}}break;}}c.fItems[i].Action=a;sap.ui.getCore().getModel("SplCreateNewTourModel").setData(m);this.getView().getViewData()["oSaveButtonInstance"].setEnabled(splReusable.libs.SapSplModelFormatters.enableAssignTourButton(m));this.getView().getViewData()["tableInstance"].getContent()[m.stopsRow.length-1].getContent()[3].getContent()[1].setEnabled(splReusable.libs.SapSplModelFormatters.enableDropRemainingFreightItemsLink(m.Items,m.stopsRow.length-1));e.getSource().getParent().getParent().getCells()[6].setVisible(splReusable.libs.SapSplModelFormatters.setVisiblePropertyForOrderIdDestinationInfo(c.rowIndex,m.stopsRow,i));e.getSource().getParent().getParent().getCells()[7].setVisible(splReusable.libs.SapSplModelFormatters.setVisiblePropertyForOrderIdDestinationInfo(c.rowIndex,m.stopsRow,i));this.fnToCaptureLiveChangeToSetFlag();this.oSplNewLocationItemModel.setData(c);f=[new sap.ui.model.Filter("Action",sap.ui.model.FilterOperator.NE,"N"),new sap.ui.model.Filter("IsDeleted",sap.ui.model.FilterOperator.EQ,"0")];for(I=0;I<m.stopsRow.length;I++){this.oSplNewLocationItemModel.getData().tableInstance.getContent()[I].getContent()[2].getContent()[0].getBinding("items").filter(new sap.ui.model.Filter(f,true));}}}});
