/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.controller("splController.dialogs.SplTrackGeofenceDialog",{onInit:function(){this.oViewData=this.getView().getViewData();this.oSnlhTrackGeofenceDialogModel=new sap.ui.model.json.JSONModel();this.oSnlhTrackGeofenceDialogModel.setData(this.oViewData);this.getView().setModel(this.oSnlhTrackGeofenceDialogModel);this.fnDefineControlLabelsFromLocalizationBundle();oSapSplMapsDataMarshal.fnClearMap(sap.ui.getCore().byId("splView.liveApp.liveApp--oSapSplLiveAppMap"));var c=[];c=(this.oSnlhTrackGeofenceDialogModel.getData().geofences).concat(this.oSnlhTrackGeofenceDialogModel.getData().containerTerminal);oSapSplMapsDataMarshal.fnShowVOsOnMap(c,sap.ui.getCore().byId("splView.liveApp.liveApp--oSapSplLiveAppMap"));if(this.oSnlhTrackGeofenceDialogModel.getData().geofences.length>0){this.fnToZoomToGeofence(this.oSnlhTrackGeofenceDialogModel.getData().geofences[0]);}this.byId("SapSnlhTrackGeofenceDialogList").attachBrowserEvent("mouseover",function(e){var i;if(e.target.children[0]){i=e.target.children[0].id;}else{i=e.target.id;}if(sap.ui.getCore().byId(i)){oSapSplMapsDataMarshal.fnShowFences(sap.ui.getCore().byId(i).getBindingContext().getProperty(),sap.ui.getCore().byId("splView.liveApp.liveApp--oSapSplLiveAppMap"),"onFocus");}if(this.getParent().getController().previousFocused){if(sap.ui.getCore().byId(i)&&sap.ui.getCore().byId(i).getBindingContext()&&(this.getParent().getController().previousFocused!==sap.ui.getCore().byId(i).getBindingContext().getProperty())){oSapSplMapsDataMarshal.fnShowFences(this.getParent().getController().previousFocused,sap.ui.getCore().byId("splView.liveApp.liveApp--oSapSplLiveAppMap"));oSapSplMapsDataMarshal.fnHandleDetailWindowVisibility("Hide","Geofence");}}if(sap.ui.getCore().byId(i)){this.getParent().getController().previousFocused=sap.ui.getCore().byId(i).getBindingContext().getProperty();}});},fnToZoomToGeofence:function(d){if(d.Geometry&&JSON.parse(d.Geometry).coordinates.length>0){sap.ui.getCore().byId("splView.liveApp.liveApp--oSapSplLiveAppMap").zoomToAreas(JSON.parse(d.Geometry).coordinates[0],true);}},fnDefineControlLabelsFromLocalizationBundle:function(){},onAfterRendering:function(){},setParentDialogInstance:function(p){this.oParentDialogInstance=p;this.setButtonForDialog();},setButtonForDialog:function(){this.oSapSnlhTrackGeofenceDialogCancelButton=new sap.m.Button({press:jQuery.proxy(this.fnHandlePressOfTrackGeofenceDialogCancelButton,this)});this.oSapSnlhTrackGeofenceDialogCancelButton.setText(oSapSplUtils.getBundle().getText("CLOSE"));this.oParentDialogInstance.setEndButton(this.oSapSnlhTrackGeofenceDialogCancelButton);},fnHandlePressOfTrackGeofenceDialogCancelButton:function(){oSapSplMapsDataMarshal.fnClearMap(sap.ui.getCore().byId("splView.liveApp.liveApp--oSapSplLiveAppMap"));sap.ui.getCore().byId("splView.liveApp.liveApp").getController().fnShowAllVisualObjectsOnMap("trackgeofencedialog");this.getView().getParent().close();},fnToCaptureLiveChangeToSetFlag:function(){if(!oSapSplUtils.getIsDirty()){oSapSplUtils.setIsDirty(true);}},fnHandlePressList:function(){},fnHandlePressAccept:function(e){var x=jQuery.extend(true,{},e);var l=e.getSource().getBindingContext().getProperty();oSapSplBusyDialog.getBusyDialogInstance({title:oSapSplUtils.getBundle().getText("BUSY_DIALOG_MESSAGE")}).open();function _(){var m=this.oSnlhTrackGeofenceDialogModel.getData();m.geofences[0].RelationStatus="1";this.oSnlhTrackGeofenceDialogModel.setData(m);this.fnHandlePressOfTrackGeofenceDialogCancelButton();sap.ui.getCore().byId("splView.liveApp.liveApp").getController().fnShowAllVisualObjectsOnMap("trackgeofencedialog");jQuery(".sapUiBLy").css("z-index","0");}sap.ui.getCore().byId("splView.liveApp.liveApp").getController().fnHandleClickOfRadarGeofenceApprovalIcons(l,"1",_.bind(this));},fnHandlePressReject:function(e){var x=jQuery.extend(true,{},e);var l=x.getSource().getBindingContext().getProperty();oSapSplBusyDialog.getBusyDialogInstance({title:oSapSplUtils.getBundle().getText("BUSY_DIALOG_MESSAGE")}).open();function _(){var m=this.oSnlhTrackGeofenceDialogModel.getData();m.geofences=[];this.oSnlhTrackGeofenceDialogModel.setData(m);this.fnHandlePressOfTrackGeofenceDialogCancelButton();sap.ui.getCore().byId("splView.liveApp.liveApp").getController().fnShowAllVisualObjectsOnMap("trackgeofencedialog");oSapSplMapsDataMarshal.fnHandleDetailWindowVisibility("Hide","Geofence");}sap.ui.getCore().byId("splView.liveApp.liveApp").getController().fnHandleClickOfRadarGeofenceApprovalIcons(l,"2",_.bind(this));}});
