/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
(function(){splReusable.libs.SplTracer.trace(0,"App Container initializer");function h(E,A){oSapSplQuerySelectors.getInstance().changeUnifiedShellStyle(A);}function c(t,f){var m;if(t.sId==="splView.tileContainer.MasterTileContainer"&&f.getCustomData().length>0&&f.getCustomData()[0].getValue()===true){m=t.getModel().getData().results;for(var i=0;i<m.length;i++){if(m[i]["AppPath"]===f.sId){oSapSplTileRefresher.refreshTiles(m[i]["AppID"]);f.destroyCustomData();}}}}function a(E){if(E.getParameter("from").getController().getChildInstance){if(E.getParameter("from").getController().getChildInstance().getController().onCleanUp){E.getParameter("from").getController().getChildInstance().getController().onCleanUp();}}}function b(E){var n=jQuery.extend(true,{},E);if(oSapSplUtils.getIsDirty()){window["oSapSplNavigateEvent"]=jQuery.extend(true,{},E);sap.m.MessageBox.show(oSapSplUtils.getBundle().getText("DATA_LOSS_WARNING_TEXT"),sap.m.MessageBox.Icon.WARNING,oSapSplUtils.getBundle().getText("WARNING"),[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.CANCEL],function(s){if(s==="YES"){oSapSplUtils.setIsDirty(false);oSapSplBusyDialog.getBusyDialogInstance({type:"fiori"}).open();a(window["oSapSplNavigateEvent"]);if(window["oSapSplNavigateEvent"].getParameter("direction")==="back"){oSplBaseApplication.getAppInstance().back({goBackWithData:0});}else{oSplBaseApplication.getAppInstance().to(window["oSapSplNavigateEvent"].getParameter("toId"),{goBackWithData:0});}if(window["oSapSplNavigateEvent"].getParameter("toId")===SapSplEnums.HomePage){sap.ui.getCore().byId("sapSplBaseUnifiedShell").removeAllHeadItems();}jQuery(".sapMDialogBlockLayerInit").css("display","none");if(n.getParameters().toId===SapSplEnums.HomePage){h(n,true);}else{h(n,false);}}else{jQuery.sap.log.info("Navigate out Action cancelled");jQuery(".sapMDialogBlockLayerInit").css("display","none");}},null,oSapSplUtils.fnSyncStyleClass("messageBox"));E.preventDefault();}else{if(E.getParameters().toId==="splView.tileContainer.MasterTileContainer"){sap.ui.getCore().byId("sapSplBaseUnifiedShell").removeAllHeadItems();}}}function d(E){if((E.getParameter("toId")===SapSplEnums.HomePage)){jQuery.sap.log.info("SAP SCL App Container","Close All Dialogs","Closing Open Dialogs and Popovers");sap.ui.getCore().byId("sapSplBaseUnifiedShell").removeAllHeadItems();}sap.m.InstanceManager.closeAllDialogs(function(){sap.m.InstanceManager.closeAllPopovers();});}function e(E){if((E.getParameter("direction")==="back")||(E.getParameter("direction")==="backToTop")||(E.getParameter("toId")==="splView.tileContainer.MasterTileContainer")){jQuery.sap.log.debug("SAP SCL App Container","Clear Interval ID for "+oSapSplUtils.getIntervalIds().length+" Intervals","SAP SCL App Container");for(var i=0;i<oSapSplUtils.getIntervalIds().length;i++){window.clearInterval(oSapSplUtils.getIntervalIds()[i]);}}}window["oSplBaseApplication"]={getAppInstance:function(){return sap.ui.getCore().byId("sapSplBaseApplication");},getData:function(){return new sap.m.App("sapSplBaseApplication",{orientationChange:jQuery.proxy(this.handleOrientationChange,this),afterNavigate:jQuery.proxy(this.handleAfterNavigate,this),navigate:jQuery.proxy(this.handleNavigate,this)});},handleOrientationChange:function(E){jQuery.sap.log.info(E.toString());},handleHelpButtonHide:function(E){$.sap.log.info("SAP SCL App Container","Help Button Hide Event fired"+E.toString(),"SAPSCL");sap.ui.getCore().getModel("helpModel").getData()["helpVisible"]=false;sap.ui.getCore().getModel("helpModel").refresh();},handleAfterNavigate:function(E){jQuery.sap.log.info(E.toString());$.sap.log.info("SCL App Container After Navigate","App navigation complete","SAPSCL");if(E.getParameters().toId===SapSplEnums.HomePage){c(E.getParameter("to"),E.getParameter("from"));}oSapSplQuerySelectors.getInstance().setBackButtonTooltip();oSapSplBusyDialog.getBusyDialogInstance({type:"fiori"}).close();},handleNavigate:function(E){if(oSapSplUtils.getIsDirty()){b(E);}else{d(E);if(E.getParameters().toId===SapSplEnums.HomePage){h(E,true);}}if(E.getParameters().toId!==SapSplEnums.HomePage){h(E,false);}e(E);this.handleHelpButtonHide(E);}};splReusable.libs.SplTracer.trace(1,"App Container initializer");}());
