/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.require("splReusable.exceptions.MissingParametersException");jQuery.sap.require("splReusable.exceptions.InvalidArrayException");jQuery.sap.require("splReusable.libs.SapSplModelFormatters");jQuery.sap.require("splReusable.libs.SapSplEnums");jQuery.sap.require("splReusable.libs.SapSplChatBoxControl");splReusable.libs.SapSplStyleSheetLoader.loadStyle("./resources/styles/sapSplLiveFeedControl");jQuery.sap.declare("splReusable.libs.SapSplLiveFeedControl");
function startPollingOfLiveFeed(t,s){if(t.liveFeedInterval!==undefined){clearInterval(t.liveFeedInterval);}t.liveFeedInterval=window.setInterval(function(){t.refreshLiveFeedModel();},t.iInterval);if(s!==undefined&&s!==null&&s===true){oSapSplUtils.setIntervalId(t.liveFeedInterval);}}
function fnHandleOnAfterRenderingOfTheFeedList(){if(this.oFeedList){if(this.oFeedList.getItems()&&this.oFeedList.getItems().length===0){this.oFeedList.setShowNoData(true);}else{this.oFeedList.setShowNoData(false);}}var l=$(window).height()-$(".sapUiUfdShellHead").height()-$(".splMapTollbarBar").height()-$(".sapMFooter-CTX").height();$(".sapSplMessageFeedListContainer").css("height",l+"px");$(".sapSplFeedBlocker").css("height",l+"px");$(".sapSplExpandedSearchListContainer").css("height",l+"px");}
function getFooterDiv(o){var H="";var p=o["Priority"];var P=null;if(p==="3"){P="Medium";}else if(p==="4"){P="Low";}if(p&&(p==="1"||p==="2")){if(o["isNotification"]==="1"){if(o["isActive"]==="1"){H+="<span class=HighPriority>";}else{H+="<span class=Expired>";}if(o["isActive"]==="1"){H+=o["Priority.description"]+"</span>";}else{H+=oSapSplUtils.getBundle().getText("EXPIRED")+"</span>";}}else{H+="<span class=HighPriority>";if(o["Priority.description"]){H+=o["Priority.description"]+"</span>";}else{H+=""+"</span>";}}H+="<div class='dateClassForMessage'>";}else{H+="<div class="+P+"Priority>";if(o["Priority.description"]){H+=o["Priority.description"]+"</div>";}else{H+=""+"</div>";}H+="<div class='dateClassForMessage'>";}if(o["isNotification"]&&o["isNotification"]==="1"){H+=""+"</div>";}else{H+=splReusable.libs.SapSplModelFormatters.returnMessageTimestamp(o["ReportedTime"],o["MessageType"])+"</div>";}return H;}
function fnHandleOnAfterRenderingOfTheFeedListItem(e){var s="";var i=null,r=null,R=null;if(e.srcControl.getBindingContext().getProperty("isSentByMe")!==undefined){i=e.srcControl.getBindingContext().getProperty("isSentByMe");}$(".detailOverlayClass").remove();e.srcControl.getParent().$().append("<div id='feedMessageDetailOverlay' class='detailOverlayClass'></div>");$("#feedMessageDetailOverlay").css("display","none");r=e.srcControl.getBindingContext().getProperty("RecipientName");R=e.srcControl.getBindingContext().getProperty("RecipientCount");if(R!==undefined){e.srcControl.$().attr("title",splReusable.libs.SapSplModelFormatters.returnFeedMessageTooltip(r,R));}s=e.srcControl.getBindingContext().getObject()["SenderName"];if(!s){e.srcControl.setMaxCharacters(60);}else{e.srcControl.setMaxCharacters(75);}if($("#"+e.srcControl.sId+" .sapMFeedListItemFooter")[0]){$("#"+e.srcControl.sId+" .sapMFeedListItemFooter")[0].innerHTML=getFooterDiv(e.srcControl.getBindingContext().getObject());}if(e.srcControl.getBindingContext().getObject()["MessageType"]==="BM"||e.srcControl.getBindingContext().getObject()["MessageType"]==="DM"){if(e.srcControl.getBindingContext().getObject()["isRead"]==="0"&&!e.srcControl.hasStyleClass("messageUnRead")){e.srcControl.addStyleClass("messageUnRead");}}if(i===1){e.srcControl.addStyleClass("sapSplMessageFeedListItemRight");e.srcControl.setIcon("sap-icon://employee");}if(e.srcControl.getBindingContext().getObject().isSent===1){e.srcControl.setIcon("sap-icon://employee");var t="",f="";$("#"+e.srcControl.sId+"FromToText").remove();f=s;if(R>1){t=oSapSplUtils.getBundle().getText("MULTIPLE_RECIPIENTS");}else{if(r===null&&e.srcControl.getBindingContext().getProperty("MessageType")==="DM"){t=oSapSplUtils.getBundle().getText("NOT_AVAILABLE");}else if((r===null&&e.srcControl.getBindingContext().getProperty("MessageType")==="TC")||(r===null&&e.srcControl.getBindingContext().getProperty("MessageType")==="BM")||(r===null&&e.srcControl.getBindingContext().getProperty("MessageType")==="BI")){t=oSapSplUtils.getBundle().getText("NOT_AVAILABLE");}else{t=r;}}$("#"+e.srcControl.sId+" .sapMFeedListItemText").prepend("<div class='sentItemsTopLayoutDiv' id="+e.srcControl.sId+"FromToText"+"></div>");$("#"+e.srcControl.sId+"FromToText")[0].innerHTML="<p><span>"+oSapSplUtils.getBundle().getText("From")+" : "+"</span>"+s+"<br/><span>"+oSapSplUtils.getBundle().getText("To")+" : "+"</span>"+t+"</p>";}}
function fnChangeMessageValidity(t,m){var h={};h["UUID"]=m["MessageUUID"];h["Type"]=m["MessageType"];h["TemplateUUID"]=m["TemplateUUID"];h["Priority"]=m["Priority"];h["OwnerID"]=m["OwnerID"];h["SenderID"]=m["SenderID"];h["Validity.StartTime"]=m["Validity_StartTime"];h["Validity.EndTime"]=new Date();h["AuditTrail.CreatedBy"]=m["AuditTrail_CreatedBy"];h["AuditTrail.ChangedBy"]=m["AuditTrail_ChangedBy"];h["AuditTrail.ChangeTime"]=m["AuditTrail_ChangeTime"];h["SourceLocation"]=m["SourceLocation"];h["ThreadUUID"]=m["ThreadUUID"];h["ChangeMode"]="U";var p={Header:[h],inputHasChangeMode:true,Text:[],Recipient:[],Object:"MessageOccurrence"};oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getFQServiceUrl("sap/spl/xs/app/services/updateMessageStatus.xsjs"),method:"PUT",async:false,cache:false,data:JSON.stringify(p),success:function(d,s,a){oSapSplBusyDialog.getBusyDialogInstance().close();if(d.constructor===String){d=JSON.parse(d);}if(a["status"]===200&&d["Error"].length===0){t.refreshLiveFeedModel();}else if(d["Error"].length>0){var e=oSapSplUtils.getErrorMessagesfromErrorPayload(d)["ufErrorObject"];sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getErrorMessagesfromErrorPayload(d)["errorWarningString"],details:e});}},error:function(e){oSapSplBusyDialog.getBusyDialogInstance().close();if(e&&e["status"]===500){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["status"]+" "+e.statusText,details:e.responseText});}},complete:function(x){if(x.responseText.constructor===String){x.responseText=JSON.parse(x.responseText);}var e=oSapSplUtils.getErrorMessagesfromErrorPayload(x.responseText);if(x.status===400){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["errorWarningString"],details:e["ufErrorObject"]});}}});}
function respondToBussinessPartnerRequest(t,a,G,c,m){var p={};p["inputHasChangeMode"]=false;p["Relation"]=[{UUID:G,Status:t,InstanceUUID:null}];oSapSplBusyDialog.getBusyDialogInstance().open();oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getFQServiceUrl("sap/spl/xs/app/services/businessPartner.xsjs"),method:"PUT",async:false,cache:false,data:JSON.stringify(p),success:function(d,s,b){oSapSplBusyDialog.getBusyDialogInstance().close();if(d.constructor===String){d=JSON.parse(d);}if(b["status"]===200&&d["Error"].length===0){$("#"+c).remove();if(m){fnChangeMessageValidity(a,m);}else{a.refreshLiveFeedModel();}}else if(d["Error"].length>0){var e=oSapSplUtils.getErrorMessagesfromErrorPayload(d)["ufErrorObject"];sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getErrorMessagesfromErrorPayload(d)["errorWarningString"],details:e});$("#"+c).remove();if(m){fnChangeMessageValidity(a,m);}else{a.refreshLiveFeedModel();}}},error:function(e){oSapSplBusyDialog.getBusyDialogInstance().close();if(e&&e["status"]===500){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["status"]+" "+e.statusText,details:e.responseText});$("#"+c).remove();if(m){fnChangeMessageValidity(a,m);}else{a.refreshLiveFeedModel();}}},complete:function(x){if(x.responseText.constructor===String){x.responseText=JSON.parse(x.responseText);}var e=oSapSplUtils.getErrorMessagesfromErrorPayload(x.responseText);if(x.status===400){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["errorWarningString"],details:e["ufErrorObject"]});}}});}
function navigateToAnotherApp(p){var n=p;var N=null;if(!sap.ui.getCore().byId("sapSplBaseApplication").getPage(n)){N=sap.ui.view({viewName:n,id:n,type:sap.ui.core.mvc.ViewType.XML});N.addEventDelegate({onBeforeShow:jQuery.proxy(N.getController().onBeforeShow,N.getController())});sap.ui.getCore().byId("sapSplBaseApplication").addPage(N);}oSplBaseApplication.getAppInstance().to(n,"slide");}
function openTrackGeofenceDialog(m){var v={},t="";var a=sap.ui.getCore().getModel("SapSplLeftPanelListModel").getData();v.geofences=[];v.containerTerminal=[];if(m["ReferenceLocationName"]){v.ReferenceLocationName=m["ReferenceLocationName"];}for(var i=0;i<a.length;i++){if(a[i].Tag==="LC0008"){if(a[i].LocationID===m["ReferenceObjectUUID"]){v.geofences.push(a[i]);if(a[i]["RelationStatus"]==="0"){t=oSapSplUtils.getBundle().getText("TRACK_GEOFENCE_DIALOG_TITLE",m["SenderName"]);}}}if(a[i].Tag==="LC0003"){if(a[i].OwnerID===m["SenderID"]){v.containerTerminal.push(a[i]);}}}var b=sap.ui.view({viewName:"splView.dialogs.SplTrackGeofenceDialog",type:sap.ui.core.mvc.ViewType.XML,viewData:v});var c=new sap.m.Dialog({title:t,tooltip:t,content:b,draggable:true,contentWidth:"10rem"}).addStyleClass("sapSnlhTrackGeofenceDialog").open();c.attachAfterOpen(function(){oSapSplUtils.fnSyncStyleClass(c);sap.ui.getCore().byId("splView.liveApp.liveApp").getController().fnBlockUnblockLiveAppUI("Block");});c.attachAfterClose(function(e){sap.ui.getCore().byId("splView.liveApp.liveApp").getController().fnBlockUnblockLiveAppUI("Unblock");e.getSource().destroy();});c.addEventDelegate({onAfterRendering:function(e){sap.ui.getCore().byId("splView.liveApp.liveApp").getController().fnHandleDialogMove(e.srcControl);sap.ui.getCore().byId("splView.liveApp.liveApp").getController().fnHandleDialogPositioning(e.srcControl);}});b.getController().setParentDialogInstance(c);}
function openSidePanelSelectRejectedGeofences(m){var c;sap.ui.getCore().byId("splView.liveApp.liveApp--sapSplTrafficStatusContainer").setMode("ShowHideMode");sap.ui.getCore().byId("splView.liveApp.liveApp--idSapSplLeftPanelIconTabBar").setSelectedKey("Geofences");sap.ui.getCore().byId("splView.liveApp.liveApp--idSapSplLeftPanelIconTabBar").fireSelect({item:sap.ui.getCore().byId("splView.liveApp.liveApp--SapSplLeftPanelFilterGeofences"),selectedKey:"Geofences"});for(var i=0;i<sap.ui.getCore().byId("splView.liveApp.liveApp--SapSplLeftPanelList").getItems().length;i++){if(sap.ui.getCore().byId("splView.liveApp.liveApp--SapSplLeftPanelList").getItems()[i].getType()==="Active"){if(sap.ui.getCore().byId("splView.liveApp.liveApp--SapSplLeftPanelList").getItems()[i].getBindingContext().getProperty().Tag==="LC0008"){if(sap.ui.getCore().byId("splView.liveApp.liveApp--SapSplLeftPanelList").getItems()[i].getBindingContext().getProperty().LocationID===m["ReferenceObjectUUID"]){sap.ui.getCore().byId("splView.liveApp.liveApp--SapSplLeftPanelList").getItems()[i].setSelected(true);sap.ui.getCore().byId("splView.liveApp.liveApp--SapSplLeftPanelList").fireSelect({listItem:sap.ui.getCore().byId("splView.liveApp.liveApp--SapSplLeftPanelList").getItems()[i],selected:true});c=oSapSplMapsDataMarshal.convertGeoJSONToString(JSON.parse(sap.ui.getCore().byId("splView.liveApp.liveApp--SapSplLeftPanelList").getItems()[i].getBindingContext().getProperty().Geometry));c=oSapSplMapsDataMarshal.fnGetPointFromPolygon(c);var l=c.split(";")[1];var L=c.split(";")[0];sap.ui.getCore().byId("splView.liveApp.liveApp--oSapSplLiveAppMap").zoomToGeoPosition(parseFloat(L,10),parseFloat(l,10),parseFloat("1",10));break;}}}}}
function getFeedMessageDetailLayout(M,t){var p="",f="",T="",F="";f="$filter=MessageUUID eq X'"+oSapSplUtils.base64ToHex(M)+"'";p="/FeedRecipientList";t.oDataModel.read(p,null,[f],true,function(r){var n=0;for(var i=0;i<r.results.length;i++){if(r.results[i]["RecipientName"]!==null){T+=r.results[i]["RecipientName"]+" , ";}else{n=n+1;}}if(n>0){T+=oSapSplUtils.getBundle().getText("NOT_AVAILABLE_MULTIPLE",n);}else{var I=T.lastIndexOf(" , ");T=T.substr(0,I)+""+T.substr(I+3);}F=r.results[0]["SenderName"];$(".detailOverlayClass")[0].innerHTML="<p><span>"+oSapSplUtils.getBundle().getText("From")+" : "+"</span>"+F+"<br/><span>"+oSapSplUtils.getBundle().getText("To")+" : "+"</span>"+T+"</p>";},function(){});}
function openOverlayForDetails(c,e,t){var l=e.getSource().$().parent().parent().prev();var i="feedMessageDetailOverlay";if($("#"+i).css("display")==="none"){$(".detailOverlayClass")[0].innerHTML="";getFeedMessageDetailLayout(sap.ui.getCore().byId(l.attr("id")).getBindingContext().getObject()["MessageUUID"],t);}if($("#"+i).css("display")==="none"){$("#"+i).show();}else{$("#"+i).hide();}$("#"+i).css("top",l.position()["top"]);$("#"+i).css("height",l.height());}
function fnHandlePressOfContextItem(e){var t=this;var b=e.getSource().getBindingContext().getProperty();if(b["ActionType"]==="RC"){var m=null,c=0;b["liveFeed"]=this.oFeedListControl;b["chatBoxConsoleApp"]=this.oChatBoxContainerApp;b["headerLabel"]=this.oSapSplChatBoxConsoleHeaderLabel;if(!this.oListOfChatBoxes[b["ThreadUUID"]]){var C=new splReusable.libs.SapSplChatBoxControl(b);this.oListOfChatBoxes[b["ThreadUUID"]]=C;C.setListOfChatBoxes(this.oListOfChatBoxes);}else{this.oListOfChatBoxes[b["ThreadUUID"]].startPolling();m=sap.ui.getCore().getModel("sapSplChatBoxConsoleLeftListModel").getData();for(c=0;c<m.length;c++){if(m[c]["ThreadUUID"]===b["ThreadUUID"]){break;}}if(c===m.length){m.push(b);this.oSapSplChatBoxConsoleHeaderLabel.setText(oSapSplUtils.getBundle().getText("CHATBOX_CONSOLE_HEADER_LABEL",m.length));sap.ui.getCore().getModel("sapSplChatBoxConsoleLeftListModel").setData(m);}else{if(this.oListOfChatBoxes[b["ThreadUUID"]].getListItemInstance()){this.oListOfChatBoxes[b["ThreadUUID"]].getListItemInstance().firePress();}}if($(".sapSplChatBoxConsoleParentClosed").css("display")==="none"||$(".sapSplChatBoxConsoleParent").css("display")==="none"){$(".sapSplChatBoxConsoleParent").show("slow");$(".sapSplChatBoxConsoleParentClosed").show("slow");}if(m.length>1){this.oChatBoxContainerApp.getParent().removeStyleClass("sapSplChatBoxConsoleClosed").addStyleClass("sapSplChatBoxConsole");this.oChatBoxContainerApp.getParent().getParent().removeStyleClass("sapSplChatBoxConsoleParentClosed").addStyleClass("sapSplChatBoxConsoleParent");$("#chatBoxConsoleContainerDiv").css("right","50.5em");}setTimeout(function(){t.oListOfChatBoxes[b["ThreadUUID"]].rerenderTextAreaInstance();},1000);}}else if(b["ActionType"]==="LM"){if(b["MessageType"]==="I"||b["MessageType"]==="TM"){this.parentControllerInstance.feedlistToMapInterface(b["InstanceUUID"],"Incidents");}else{if(b["isThirdPartyMessage"]===1||b["isSent"]===1){this.parentControllerInstance.feedlistToMapInterface(b["RecipientUUID"],"Trucks");}else{this.parentControllerInstance.feedlistToMapInterface(b["SenderID"],"Trucks");}}}else if(b["ActionType"]==="A"){if(b["MessageType"]==="BI"){if(e.getSource().getCustomData().length>0){respondToBussinessPartnerRequest("1",this,b["RelationUUID"],e.getSource().getParent().$().parent().attr("id"),e.getSource().getCustomData()[0].getValue());}else{respondToBussinessPartnerRequest("1",this,b["RelationUUID"],e.getSource().getParent().$().parent().attr("id"),null);}}}else if(b["ActionType"]==="R"){if(b["MessageType"]==="BI"){if(e.getSource().getCustomData().length>0){respondToBussinessPartnerRequest("2",this,b["RelationUUID"],e.getSource().getParent().$().parent().attr("id"),e.getSource().getCustomData()[0].getValue());}else{respondToBussinessPartnerRequest("2",this,b["RelationUUID"],e.getSource().getParent().$().parent().attr("id"),null);}}}else if(b["ActionType"]==="AN"){navigateToAnotherApp(b["NavigationPath"]);}else if(b["ActionType"]==="DT"){openOverlayForDetails(b,e,this);}else if(b["ActionType"]==="OD"){sap.ui.getCore().byId("splView.liveApp.liveApp").getController().oMapToolbar.refreshMap(" ");openTrackGeofenceDialog(e.getSource().getCustomData()[0].getValue());}else if(b["ActionType"]==="OP"){openSidePanelSelectRejectedGeofences(e.getSource().getCustomData()[0].getValue());}}
function getContextLayout(b,t){var p="/FeedListControl?$filter=MessageUUID eq X'"+oSapSplUtils.base64ToHex(b["MessageUUID"])+"\'";if(b.MessageType==="DM"){p="/FeedListControl?$filter=MessageUUID eq X'"+oSapSplUtils.base64ToHex(b["MessageUUID"])+"\'"+" and RecipientUUID eq X'"+oSapSplUtils.base64ToHex(b["RecipientUUID"])+"\'";}var a=[];if(!t.oDataModel){t.oDataModel=sap.ui.getCore().getModel("LiveFeedContextODataModel");}t.oDataModel.read(p,null,[],false,function(r){a=r.results;for(var i=0;i<a.length;i++){if(a[i]["canViewContext"]===0){a.splice(i,1);}}},function(){});if(a.length===0){return null;}else{var T=new sap.m.Toolbar({content:{path:"/",template:new sap.ui.core.Icon({src:"{Icon}",color:"#666666",press:jQuery.proxy(fnHandlePressOfContextItem,t),tooltip:{path:"ActionType",formatter:function(A){if(A==="RC"){return oSapSplUtils.getBundle().getText("REPLY_THROUGH_CHAT");}else if(A==="LM"){return oSapSplUtils.getBundle().getText("LOCATE_ON_MAP");}else if(A==="A"){return oSapSplUtils.getBundle().getText("ACCEPT");}else if(A==="R"){return oSapSplUtils.getBundle().getText("REJECT");}else if(A==="AN"){return oSapSplUtils.getBundle().getText("APP_TO_APP_NAVIGATION");}else if(A==="DT"){return oSapSplUtils.getBundle().getText("MESSAGE_DETAILS");}}}}).addStyleClass("contextBarIcon").addCustomData(new sap.ui.core.CustomData({key:"messageBoundObject",value:b}))}}).setModel(new sap.ui.model.json.JSONModel(a)).addStyleClass("contextBar");T.addEventDelegate({onAfterRendering:function(e){var c=e.srcControl.getContent();if(c.constructor===Array){for(var i=0;i<c.length;i++){var A=c[i].getBindingContext().getObject();if(A["ActionType"]==="RC"){c[i].firePress();c[i].setVisible(false);}else if((A["ActionType"]==="DT"&&A["isSent"]===1&&A["RecipientCount"]===1)){c[i].setVisible(false);if(c.length===1){e.srcControl.setVisible(false);e.srcControl.$().parent().hide();}}else if(A["ActionType"]==="OD"||A["ActionType"]==="OP"){c[i].firePress();if(c.length===1){e.srcControl.setVisible(false);e.srcControl.$().parent().hide();}}}}}});return T;}}
function removeOtherSelections(a,f){if(f&&f.getItems()){for(var i=0;i<f.getItems().length;i++){var l=f.getItems()[i];if(l.sId!==a){if(l.getCustomData().length===1){var c=l.getCustomData()[0].getValue();if(c.state==="show"){$("#"+c.id).hide();c.state="hide";l.getCustomData()[0].setValue(c);}}}}}}
function fnMakeTheListItemAsReadUnread(m,t){var h={},T={},r={};h["UUID"]=m["MessageUUID"];h["Type"]=m["MessageType"];h["TemplateUUID"]="";h["Priority"]=m["Priority"];h["OwnerID"]=m["OwnerID"];h["SenderID"]=m["SenderID"];h["Validity.StartTime"]=m["Validity_StartTime"].toJSON();h["Validity.EndTime"]=m["Validity_EndTime"].toJSON();h["AuditTrail.CreatedBy"]=null;h["AuditTrail.ChangedBy"]=null;h["AuditTrail.CreationTime"]=null;h["AuditTrail.ChangeTime"]=null;h["SourceLocation"]=m["SourceLocation"];h["ThreadUUID"]=m["ThreadUUID"];h["ChangeMode"]="U";var R="Truck";if(m["MessageType"]==="DM"||m["MessageType"]==="BM"){R="BusinessPartner";}r["RecipientUUID"]=m["RecipientUUID"];r["UUID"]=m["MessageRecipientID"];r["ParentUUID"]=m["MessageUUID"];r["RecipientType"]=R;r["isRead"]="1";r["ChangeMode"]="U";T["UUID"]=m["MessageUUID"];T["ShortText"]=m["Text1"];T["LongText"]=m["Text1"];T["ChangeMode"]="U";var p={Header:[h],Recipient:[r],Text:[T],Object:"MessageOccurrence",inputHasChangeMode:true};setTimeout(function(){if(t.oListOfChatBoxes[h["ThreadUUID"]]){t.oListOfChatBoxes[h["ThreadUUID"]].focusOnLastItem();}},1000);oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getFQServiceUrl("sap/spl/xs/app/services/updateMessageStatus.xsjs"),method:"PUT",data:JSON.stringify(p),success:function(d,s,a){if(d.constructor===String){d=JSON.parse(d);}if(a["status"]===200&&d["Error"].length===0){t.refreshLiveFeedModel();}else{var e=oSapSplUtils.getErrorMessagesfromErrorPayload(d)["ufErrorObject"];sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getErrorMessagesfromErrorPayload(d)["errorWarningString"],details:e});}},error:function(e){if(e&&e["status"]===500){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["status"]+" "+e.statusText,details:e.responseText});}else{sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getErrorMessagesfromErrorPayload(JSON.parse(e.responseText))["errorWarningString"],details:oSapSplUtils.getErrorMessagesfromErrorPayload(JSON.parse(e.responseText))["ufErrorObject"]});}},complete:function(){}});}
function fnHandleSelectOfListItem(e){$("#feedMessageDetailOverlay").hide();var s=null;var t=this,i="",m=null,p="ThreadUUID";s=e.getParameters().listItem;var M=s.getBindingContext().getProperty();var S="";S=M["MessageType"];if((S==="BM"||S==="DM")&&M["isRead"]==="0"){fnMakeTheListItemAsReadUnread(M,t);}if(this.allowFeedListSelection!==undefined&&this.allowFeedListSelection===true){s.addStyleClass("sapSplMessageFeedListItemSelected");m=s.getBindingContext().getObject()["MessageType"];if(m==="I"||m==="TM"){p="MessageUUID";}this.openContextUUID=s.getBindingContext().getProperty(p);s.setSelected(true);removeOtherSelections(s.sId,e.getSource());if(s.getCustomData().length===1&&$("#"+s.getCustomData()[0].getValue().id).css("display")==="block"){$("#"+s.getCustomData()[0].getValue().id).remove();s.destroyCustomData();}else{var l=null;s.destroyCustomData();if(s.getBindingContext().getProperty()["isSent"]===1){if(!this.oOpenedContextSentDetails[s.getBindingContext().getProperty()[p]]){l=getContextLayout(s.getBindingContext().getProperty(),t);if(m!=="AG"&&m!=="RG"){this.oOpenedContextSentDetails[s.getBindingContext().getProperty()[p]]=l;}}else{l=this.oOpenedContextSentDetails[s.getBindingContext().getProperty()[p]];}}else{if(!this.oOpenedContextDetails[s.getBindingContext().getProperty()[p]]){l=getContextLayout(s.getBindingContext().getProperty(),t);if(S==="DM"){if(m!=="AG"&&m!=="RG"){this.oOpenedContextDetails[s.getBindingContext().getProperty()[p]]=null;}}else{if(m!=="AG"&&m!=="RG"){this.oOpenedContextDetails[s.getBindingContext().getProperty()[p]]=l;}}}else{l=this.oOpenedContextDetails[s.getBindingContext().getProperty()[p]];}}if(l){i=new Date().getTime().toString();$("<div id="+i+" class='contextBarParentDiv'></div>").insertAfter(e.getParameters().listItem.$());s.addCustomData(new sap.ui.core.CustomData({key:"id",value:{id:i,state:"show"}}));l.placeAt(i);}}}e.getSource().removeSelections();}
function navigateToPreviouslySelectedFilter(){var s=this.oPressedFilterButton.getParent();for(var i=0;i<s.getItems().length;i++){s.getItems()[i].removeStyleClass("addHighlight");}this.oPressedFilterButton.addStyleClass("addHighlight");this.oNav.back();}
function fnFetchUserPreferences(){var m=sap.ui.getCore().getModel("sapSplFeedUserPreferencesJSONModel");oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getFQServiceUrl("/sap/spl/xs/app/services/appl.xsodata/PersonPreferences?$format=json"),method:"GET",async:true,success:function(d){var D=d.d.results[0];var t={};t["1"]=false;t["6"]=false;t["12"]=false;t["24"]=false;t[null]=false;D["MessagePreferences_Priorities_VeryHigh"]=(D["MessagePreferences_Priorities_VeryHigh"]==="1")?true:false;D["MessagePreferences_Priorities_High"]=(D["MessagePreferences_Priorities_High"]==="1")?true:false;D["MessagePreferences_Priorities_Medium"]=(D["MessagePreferences_Priorities_Medium"]==="1")?true:false;D["MessagePreferences_Priorities_Low"]=(D["MessagePreferences_Priorities_Low"]==="1")?true:false;if(!D["MessagePreferences_SelectionTimeWindowInSeconds"]){t[null]=true;}else{t[(D["MessagePreferences_SelectionTimeWindowInSeconds"]/3600).toString()]=true;}var M={UUID:D["UUID"],Priority:[{Name:oSapSplUtils.getBundle().getText("INCIDENTS_PRIORITY_1"),selected:D["MessagePreferences_Priorities_VeryHigh"]},{Name:oSapSplUtils.getBundle().getText("INCIDENTS_PRIORITY_2"),selected:D["MessagePreferences_Priorities_High"]},{Name:oSapSplUtils.getBundle().getText("INCIDENTS_PRIORITY_3"),selected:D["MessagePreferences_Priorities_Medium"]},{Name:oSapSplUtils.getBundle().getText("INCIDENTS_PRIORITY_4"),selected:D["MessagePreferences_Priorities_Low"]},{Name:oSapSplUtils.getBundle().getText("NO_PRIORITY_MESSAGES"),selected:true,ID:"NONE"}],Time:[{Name:oSapSplUtils.getBundle().getText("TIME_FILTER_ONE_HOUR",1),selected:t["1"],ID:1*3600},{Name:oSapSplUtils.getBundle().getText("TIME_FILTER_MULTIPLE_HOURS",6),selected:t["6"],ID:6*3600},{Name:oSapSplUtils.getBundle().getText("TIME_FILTER_MULTIPLE_HOURS",12),selected:t["12"],ID:12*3600},{Name:oSapSplUtils.getBundle().getText("TIME_FILTER_MULTIPLE_HOURS",24),selected:t["24"],ID:24*3600},{Name:oSapSplUtils.getBundle().getText("FILTER_LABEL_ALL"),selected:t[null],ID:null}]};m.setData(M);},error:function(){}});}
function fnHandleClickOfSetFilterOption(e){this.BlockerLayout.addStyleClass("sapSplFeedBlockerHide");var s=e.getSource().getParent();for(var i=0;i<s.getItems().length;i++){s.getItems()[i].removeStyleClass("addHighlight");}if(this.oNav.getCurrentPage().sId===this.oNav.getPages()[1].sId){if(this.oFeedListControl.getContent()[1].hasStyleClass("liveFeedHidden")){this.oFeedListControl.getContent()[1].removeStyleClass("liveFeedHidden");e.getSource().addStyleClass("addHighlight");}else{this.oFeedListControl.getContent()[1].addStyleClass("liveFeedHidden");}}else{e.getSource().addStyleClass("addHighlight");this.oFeedListControl.getContent()[1].removeStyleClass("liveFeedHidden");fnFetchUserPreferences();this.oNav.to(this.oNav.getPages()[1].sId);}}
function fnHandleClickOfSaveFilterPreferences(){var t=this;var p=sap.ui.getCore().getModel("sapSplFeedUserPreferencesJSONModel").getData(),T=0;for(var i=0;i<p["Time"].length;i++){if(p["Time"][i].selected===true){T=p["Time"][i].ID;break;}}var P={"Data":[{"UUID":p["UUID"],"MessagePreferences.Priorities.Low":(p["Priority"][3]["selected"]===true)?"1":"0","MessagePreferences.Priorities.Medium":(p["Priority"][2]["selected"]===true)?"1":"0","MessagePreferences.Priorities.High":(p["Priority"][1]["selected"]===true)?"1":"0","MessagePreferences.Priorities.VeryHigh":(p["Priority"][0]["selected"]===true)?"1":"0","MessagePreferences.SelectionTimeWindowInSeconds":T,"AuditTrail.CreatedBy":null,"AuditTrail.ChangedBy":null,"AuditTrail.CreationTime":null,"AuditTrail.ChangeTime":null}]};oSapSplAjaxFactory.fireAjaxCall({url:oSapSplUtils.getFQServiceUrl("sap/spl/xs/app/services/personPreferences.xsjs"),method:"PUT",async:false,cache:false,data:JSON.stringify(P),success:function(d,s,m){oSapSplBusyDialog.getBusyDialogInstance().close();if(d.constructor===String){d=JSON.parse(d);}if(m["status"]===200&&d["Error"].length===0){t.oPressedFilterButton.firePress();}else if(d["Error"].length>0){var e=oSapSplUtils.getErrorMessagesfromErrorPayload(d)["ufErrorObject"];sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:oSapSplUtils.getErrorMessagesfromErrorPayload(d)["errorWarningString"],details:e});}},error:function(e){oSapSplBusyDialog.getBusyDialogInstance().close();if(e&&e["status"]===500){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["status"]+" "+e.statusText,details:e.responseText});}},complete:function(x){if(x.responseText.constructor===String){x.responseText=JSON.parse(x.responseText);}var e=oSapSplUtils.getErrorMessagesfromErrorPayload(x.responseText);if(x.status===400){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["errorWarningString"],details:e["ufErrorObject"]});}}});}
splReusable.libs.SapSplLiveFeedControl=function(f){this.oListOfChatBoxes={};this.oFeedListCount={};this.oExpandedListItems={};this.parentControllerInstance=f["parentControllerInstance"];if(splReusable.libs.SapSplLiveFeedControl.prototype._singletonInstance){return splReusable.libs.SapSplLiveFeedControl.prototype._singletonInstance;}var t=this;this.oOpenedContextDetails={};this.oOpenedContextSentDetails={};this.openContextUUID=null;this.oFeedListControlModel=new sap.ui.model.json.JSONModel(f);this.oFeedFilterLayout=new sap.m.HBox().addStyleClass("sapSplFeedFilterLayout");this.oFeedFilterLayout.bindAggregation("items","/feedFilters",function(i,b){if(b.getProperty("icon")==="All"){var T=new sap.m.Button({text:oSapSplUtils.getBundle().getText("FILTER_LABEL_ALL"),type:"Transparent",tooltip:b.getProperty("tooltip"),visible:b.getProperty("visible")}).attachPress(jQuery.proxy(f["feedControlEventHandler"],t));t.oPressedFilterButton=T;return T.addStyleClass("sapSplFeedFilterLayoutButton").addStyleClass("addHighlight");}else if(b.getProperty("name")==="Filter"){return new sap.m.Button({icon:b.getProperty("icon"),type:"Transparent",tooltip:b.getProperty("tooltip"),visible:f["showCollapseButton"]}).attachPress(jQuery.proxy(fnHandleClickOfSetFilterOption,t)).addStyleClass("sapSplFeedFilterLayoutButton").addStyleClass("filterButton");}else{return new sap.m.Button({icon:b.getProperty("icon"),type:"Transparent",tooltip:b.getProperty("tooltip"),visible:b.getProperty("visible")}).attachPress(jQuery.proxy(f["feedControlEventHandler"],t)).addStyleClass("sapSplFeedFilterLayoutButton");}});var F=this.getListItemInstance();this.oFeedList=new sap.m.List({enableBusyIndicator:false,select:jQuery.proxy(fnHandleSelectOfListItem,t),mode:"SingleSelectMaster",includeItemInSelection:true,noDataText:oSapSplUtils.getBundle().getText("NO_MESSAGES_TEXT"),showNoData:false,growing:true,growingScrollToLoad:true,growingThreshhold:20}).addStyleClass("sapSplMessageFeedList");this.oFeedListFilterLabel=new sap.m.Label({text:oSapSplUtils.getBundle().getText("ALL_MESSAGES")}).addStyleClass("sapSplFeedListToolbarTitle");this.oFeedListFilterToolbar=new sap.m.Toolbar({design:"Auto"}).addContent(this.oFeedListFilterLabel).addStyleClass("sapSplFeedListFilterToolbar");this.oFeedList.bindItems({path:f["sMessageEntity"],template:F,sorter:new sap.ui.model.Sorter("ReportedTime",true)});this.oFeedFilterLayout.setModel(this.oFeedListControlModel);this.oFeedFilterLayout.getBinding("items").filter(new sap.ui.model.Filter("visible",sap.ui.model.FilterOperator.EQ,true));this.oNav=new sap.m.NavContainer().addStyleClass("sapSplMessageFeedListContainer");this.oFeedListLayoutPage=new sap.m.Page({subHeader:this.oFeedListFilterToolbar,content:this.oFeedList,showHeader:false}).addStyleClass("feedLayoutPage");this.oNav.addPage(this.oFeedListLayoutPage);var m=new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(m,"sapSplFeedUserPreferencesJSONModel");this.oNav.addPage(new sap.m.Page({showHeader:false,subHeader:new sap.m.Toolbar({design:"Auto",content:new sap.m.Label({text:oSapSplUtils.getBundle().getText("MESSAGE_PREFERENCES")}).addStyleClass("sapSplFeedListToolbarTitle")}).addStyleClass("sapSplFeedListFilterToolbar"),footer:new sap.m.Bar({contentRight:[new sap.m.Button({text:oSapSplUtils.getBundle().getText("NEW_CONTACT_SAVE"),press:jQuery.proxy(fnHandleClickOfSaveFilterPreferences,t)}),new sap.m.Button({text:oSapSplUtils.getBundle().getText("CANCEL"),press:jQuery.proxy(navigateToPreviouslySelectedFilter,t)})]}),content:[new sap.m.Panel({content:new sap.m.List({mode:"MultiSelect",select:function(e){if(e.getParameters().listItem.getBindingContext().getObject()["ID"]==="NONE"){e.getParameters().listItem.setSelected(true);}}}).bindItems("/Priority",function(i,o){var r=new sap.m.StandardListItem({title:"{Name}",selected:"{selected}"}).addStyleClass("filterSettingsListItem");if(o.getObject()["ID"]&&o.getObject()["ID"]==="NONE"){return r.addStyleClass("sapSplPointerEventsBlocker");}else{return r;}}),headerToolbar:new sap.m.Toolbar({design:"Info",content:[new sap.m.Text({text:oSapSplUtils.getBundle().getText("PRIORITY_HEADER")})]})}).addStyleClass("filterSettingsPanel"),new sap.m.Panel({content:new sap.m.List({mode:"SingleSelectLeft",items:{path:"/Time",template:new sap.m.StandardListItem({title:"{Name}",selected:"{selected}"}).addStyleClass("filterSettingsListItem")}}),headerToolbar:new sap.m.Toolbar({design:"Info",content:[new sap.m.Text({text:oSapSplUtils.getBundle().getText("TIME_HEADER")})]})}).addStyleClass("filterSettingsPanel")]}).setModel(sap.ui.getCore().getModel("sapSplFeedUserPreferencesJSONModel")).addStyleClass("feedLayoutPage"));this.BlockerLayout=new sap.ui.layout.HorizontalLayout({busyIndicatorDelay:0,busy:true}).addStyleClass("sapSplFeedBlocker").addEventDelegate({onAfterRendering:function(e){e.srcControl.$().css("height",$(window).height()-$(".sapUiUfdShellHead").height()-$(".splMapTollbarBar").height()-$(".sapMFooter-CTX").height()+"px");}}).addStyleClass("sapSplFeedBlockerHide");sap.ui.getCore().byId("splView.liveApp.liveApp--sapSplTrafficStatusMapContainer").addContent(this.oChatBoxLayout);this.oFeedListControl=new sap.ui.commons.layout.VerticalLayout().addStyleClass("sapSplFeedLayout").addContent(this.oFeedFilterLayout).addContent(this.oNav).addContent(this.BlockerLayout);this.oFeedList.addEventDelegate({onAfterRendering:jQuery.proxy(fnHandleOnAfterRenderingOfTheFeedList,t)});this.allowFeedListSelection=f["allowFeedListSelection"];if(f["refreshMode"]!=="Manual"){var I=5000;if(f["refreshInterval"]){I=f["refreshInterval"];}this.iInterval=I;}jQuery(window).resize(function(){fnHandleOnAfterRenderingOfTheFeedList();});this.oFeedListControl.placeChatBoxControl=function(){t.oChatBoxConsole.placeAt("chatBoxConsoleContainerDiv");};this.oFeedListControl.startPolling=function(M){if(M&&M==="firstTime"){t.refreshLiveFeedModel();}startPollingOfLiveFeed(t,true);};this.oFeedListControl.getChatBoxInstances=function(){return t.oListOfChatBoxes;};this.oFeedListControl.stopPolling=function(){clearInterval(t.liveFeedInterval);};this.oChatBoxContainerApp=new sap.m.NavContainer({layoutData:new sap.ui.layout.SplitterLayoutData({resizable:false}),pages:[new sap.m.Page()]});sap.ui.getCore().setModel(new sap.ui.model.json.JSONModel([]),"sapSplChatBoxConsoleLeftListModel");this.oChatBoxConsoleLeftList=new sap.m.List({mode:"Delete",items:{path:"/",template:new sap.m.StandardListItem({title:"{SenderName}",counter:0,icon:{path:"MessageType",formatter:function(T){if(T==="BM"){return"sap-icon://collaborate";}else if(T==="DM"){return"sap-icon://bussiness-suite/icon-truck-driver";}}},press:function(e){for(var i=0;i<e.getSource().getParent().getItems().length;i++){e.getSource().getParent().getItems()[i].removeStyleClass("chatBoxHasUnreadMessages");e.getSource().getParent().getItems()[i].removeStyleClass("chatBoxItemIsSelected");}e.getSource().setCounter(0);e.getSource().addStyleClass("chatBoxItemIsSelected");t.oChatBoxContainerApp.to(t.oListOfChatBoxes[e.getSource().getBindingContext().getObject()["ThreadUUID"]],"back");},type:"Active"}).addStyleClass("chatLeftPanelListItem")},"delete":function(e){t.oListOfChatBoxes[e.getParameters().listItem.getBindingContext().getObject()["ThreadUUID"]].closeChatBox();}}).setModel(sap.ui.getCore().getModel("sapSplChatBoxConsoleLeftListModel")).addStyleClass("sapSplChatBoxConsoleLeftList");this.oChatBoxConsoleLeftList.addEventDelegate({onAfterRendering:function(e){for(var i=0;i<e.srcControl.getItems().length;i++){if(t.oListOfChatBoxes[e.srcControl.getItems()[i].getBindingContext().getObject()["ThreadUUID"]]){t.oListOfChatBoxes[e.srcControl.getItems()[i].getBindingContext().getObject()["ThreadUUID"]].setListItemInstance(e.srcControl.getItems()[i]);}}if(e.srcControl.getItems().length>0){e.srcControl.getItems()[e.srcControl.getItems().length-1].firePress();}}});this.oSapSplChatBoxConsoleHeaderLabel=new sap.m.Label();function p(){var w=jQuery(window).height();var c=jQuery("#chatBoxConsoleContainerDiv").height();var C=jQuery("#chatBoxConsoleContainerDiv").offset()["top"];if((C+c/2)>w/2){jQuery("#chatBoxConsoleContainerDiv").css("bottom",(w-(C+c))+"px");jQuery("#chatBoxConsoleContainerDiv").css("top","auto");}else{jQuery("#chatBoxConsoleContainerDiv").css("bottom","auto");jQuery("#chatBoxConsoleContainerDiv").css("top",(C-45)+"px");}}this.oChatBoxConsole=new sap.m.Page({enableScrolling:false,customHeader:new sap.m.Bar({contentLeft:[this.oSapSplChatBoxConsoleHeaderLabel],contentRight:[new sap.ui.core.Icon({src:"sap-icon://less",tooltip:oSapSplUtils.getBundle().getText("MINIMIZE_CHAT_BOX_TOOLTIP"),press:function(){if($("#chatBoxConsoleContainerDiv")[0].style.height==="2em"){this.setSrc("sap-icon://less");$("#chatBoxConsoleContainerDiv").css("height","40%");}else{this.setSrc("sap-icon://collapse-group");this.getParent().getContentRight()[1].setSrc("sap-icon://full-screen");$("#chatBoxConsoleContainerDiv").css("height","2em");}},color:"white",size:"18px"}),new sap.ui.core.Icon({src:"sap-icon://full-screen",tooltip:oSapSplUtils.getBundle().getText("MAXIMIZE_CHAT_BOX_TOOLTIP"),press:function(){this.getParent().getContentRight()[0].setSrc("sap-icon://less");if(this.getSrc()==="sap-icon://full-screen"){this.setSrc("sap-icon://exit-full-screen");$("#chatBoxConsoleContainerDiv").css("height","70%");}else{this.setSrc("sap-icon://full-screen");$("#chatBoxConsoleContainerDiv").css("height","40%");}},color:"white",size:"18px"}),new sap.ui.core.Icon({src:"sap-icon://sys-cancel",tooltip:oSapSplUtils.getBundle().getText("CLOSE_CHAT_BOX_TOOLTIP"),press:function(){jQuery.each(t.oListOfChatBoxes,function(k,v){v.closeChatBox();});},color:"white",size:"18px"})]}).addStyleClass("sapSplChatBoxConsoleHeader")}).addStyleClass("sapSplChatBoxConsoleParentPage").addContent(new sap.ui.layout.Splitter({contentAreas:[new sap.m.Page({layoutData:new sap.ui.layout.SplitterLayoutData({resizable:false}),content:this.oChatBoxConsoleLeftList,showHeader:false}).addStyleClass("sapSplChatBoxConsoleLeftPanel"),this.oChatBoxContainerApp.addStyleClass("sapSplChatBoxConsoleRightPanel")]}).addEventDelegate({onAfterRendering:function(e){$("#"+e.srcControl.sId).on("mousedown",function(){jQuery("#chatBoxConsoleContainerDiv").draggable("destroy");});$("#"+e.srcControl.sId).on("mouseup",function(){jQuery("#chatBoxConsoleContainerDiv").draggable({"containment":"#sapSplBaseUnifiedShell-cntnt","stop":function(){p();}});jQuery("#chatBoxConsoleContainerDiv").draggable({"containment":"#sapSplBaseUnifiedShell-cntnt","stop":function(){p();}});});}}).addStyleClass("sapSplChatBoxConsoleClosed")).addStyleClass("sapSplChatBoxConsoleParentClosed").addEventDelegate({onAfterRendering:function(){$("#chatBoxConsoleContainerDiv").draggable({"containment":"#sapSplBaseUnifiedShell-cntnt","stop":function(){p();}});}});splReusable.libs.SapSplLiveFeedControl.prototype._singletonInstance=this.oFeedListControl.addStyleClass("right");return this.oFeedListControl.addStyleClass("right");};
splReusable.libs.SapSplLiveFeedControl.prototype.getListItemInstance=function(){var t=this;return new sap.m.FeedListItem({sender:"{SenderName}",senderActive:true,text:{parts:[{path:"Text1"},{path:"Text2"},{path:"Text2"}],formatter:splReusable.libs.SapSplModelFormatters.returnFeedMessage},timestamp:{parts:[{path:"ReportedTime"},{path:"MessageType"}],formatter:splReusable.libs.SapSplModelFormatters.returnMessageTimestamp},info:{parts:[{path:"Priority.description"},{path:"isNotification"},{path:"isActive"}],formatter:splReusable.libs.SapSplModelFormatters.returnPriorityTextByRemovingNull},icon:{parts:[{path:"ImageUrl"},{path:"MessageType"},{path:"isNotification"}],formatter:splReusable.libs.SapSplModelFormatters.returnMessageIcons}}).addStyleClass("sapSplMessageFeedListItem").addEventDelegate({onAfterRendering:jQuery.proxy(fnHandleOnAfterRenderingOfTheFeedListItem,t)});};
splReusable.libs.SapSplLiveFeedControl.prototype.getListItemInstanceForSentItems=function(){var t=this;return new sap.m.FeedListItem({text:{parts:[{path:"Text1"},{path:"Text2"},{path:"Text2"}],formatter:splReusable.libs.SapSplModelFormatters.returnFeedMessage},timestamp:{parts:[{path:"ReportedTime"},{path:"MessageType"}],formatter:splReusable.libs.SapSplModelFormatters.returnMessageTimestamp},info:{parts:[{path:"Priority.description"}],formatter:splReusable.libs.SapSplModelFormatters.returnPriorityTextByRemovingNull},icon:{parts:[{path:"ImageUrl"},{path:"MessageType"}],formatter:splReusable.libs.SapSplModelFormatters.returnMessageIcons}}).addStyleClass("sapSplMessageFeedListItem").addEventDelegate({onAfterRendering:jQuery.proxy(fnHandleOnAfterRenderingOfTheFeedListItem,t)});};
splReusable.libs.SapSplLiveFeedControl.prototype.refreshLiveFeedModel=function(){if(!this.oFeedListOdataModel){this.oFeedListOdataModel=sap.ui.getCore().getModel("LiveFeedODataModel");this.oFeedListOdataModel.setCountSupported(false);this.oFeedList.setModel(this.oFeedListOdataModel);var t=this;this.oFeedListOdataModel.attachRequestCompleted(function(e){if(!e.getParameters()["errorobject"]){t.oFeedList.setBusy(false);t.BlockerLayout.addStyleClass("sapSplFeedBlockerHide");}});this.oFeedListOdataModel.attachRequestSent(function(){if(!t.oNav.hasStyleClass("liveFeedHidden")){t.BlockerLayout.removeStyleClass("sapSplFeedBlockerHide");}});this.oFeedListOdataModel.attachRequestFailed(function(){t.BlockerLayout.addStyleClass("sapSplFeedBlockerHide");});}this.oFeedListOdataModel.refresh();};
