/*
 * Copyright (C) 2009-2015 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.declare("splReusable.libs.SapSplMapToolbar");jQuery.sap.require("splReusable.libs.SapSplMapFilterControl");jQuery.sap.require("splReusable.libs.SapSplLiveFeedControl");jQuery.sap.require("splReusable.libs.SapSplCustomSearchControl");
splReusable.libs.SapSplMapToolbar=function(t){var a=this;this.parentControllerInstance=t["parentControllerInstance"];this.oMapInstance=t.mapInstance;this.oPageInstance=t.pageInstance;var m=a.instantiateMapFilter();this.oMapToolbarJSONModel=new sap.ui.model.json.JSONModel(t);this.oParkingSpaceFilterLayout=new sap.ui.commons.layout.HorizontalLayout().addStyleClass("oSapSplMapToolbarParkingFilterLayout");var p=new sap.ui.commons.layout.HorizontalLayout({visible:"{visible}"});p.addContent(new sap.m.Text({text:"{name}"}).addStyleClass("oSapSplMapToolbarParkingFilterLayoutButton")).addContent(new sap.ui.core.Icon({src:"sap-icon://navigation-down-arrow"}).attachPress(t["toolbarEventHandler"]).addStyleClass("oSapSplMapToolbarParkingFilterLayoutButton"));this.oParkingSpaceFilterLayout.bindAggregation("content","/parkingSpaceFilters",p);this.oMapsFilterLayout=new sap.ui.layout.HorizontalLayout().addStyleClass("sapSplMapsFilterHLayout");this.oMapsFilterLayout.bindAggregation("content","/mapFilters",function(i,b){if(b.getProperty("name")==="Map"){a.oMapButton=new sap.m.Button({icon:"{icon}",visible:"{visible}",tooltip:oSapSplUtils.getBundle().getText("MAP_BUTTON_TOOLTIP")}).attachPress(function(){if(!a.oMapFilterPopover){a.oMapFilterPopover=new sap.m.Popover({modal:false,showHeader:false,height:"100px",offsetX:-123,offsetY:-8,placement:"Bottom",content:m}).addStyleClass("mapFilterPopover");}a.oSearchHorizontalLayout.getSearchFieldInstance().fnExpandCollapseSearchField("Collapse");if(a.oMapFilterPopover.isOpen()){a.oMapFilterPopover.close();}else{a.oMapFilterPopover.openBy(a.oMapButton);}}).addStyleClass("sapSplMapToolbarMapFilterButton");return a.oMapButton;}else{a.oMapButton=new sap.m.Button({icon:"{icon}",visible:"{visible}"}).attachPress(t["toolbarEventHandler"]);return a.oMapButton;}});this.oTrafficStatusTitleLabel=new sap.m.Label({text:oSapSplUtils.getBundle().getText("TRAFFIC_STATUS_TITLE")}).addStyleClass("trafficStatusTitle");this.oSearchHorizontalLayout=new splReusable.libs.SapSplCustomSearchControl({"controllerInstance":this.oPageInstance,"trafficStatusTitleLabel":this.oTrafficStatusTitleLabel});this.oToolbarBlockerLayout=new sap.ui.commons.layout.HorizontalLayout().addStyleClass("oToolbarBlockerLayout");this.oNavButton=new sap.m.Button({tooltip:oSapSplUtils.getBundle().getText("BACK_BUTTON_TOOLTIP"),visible:true,icon:"sap-icon://nav-back",press:function(){oSplBaseApplication.getAppInstance().back();}});this.oCollapseExpandLeftPanelButton=new sap.m.Button({icon:"sap-icon://list",tooltip:oSapSplUtils.getBundle().getText("ENTITIES"),press:function(){if(a.parentControllerInstance.byId("sapSplTrafficStatusContainer").getMode()==="HideMode"){a.parentControllerInstance.byId("sapSplTrafficStatusContainer").setMode("ShowHideMode");$(".sapSplLeftPanelMasterPage").css("height",$(window).height()-3*$(".sapMBar").height()+"px");}else{a.parentControllerInstance.byId("sapSplTrafficStatusContainer").setMode("HideMode");}a.parentControllerInstance.fnRenderStyle();}}).addEventDelegate({onAfterRendering:function(e){if(e.srcControl.bFirst===undefined){e.srcControl.firePress();e.srcControl.firePress();e.srcControl.bFirst=true;}}});this.oDisplayAreaLabel=new sap.m.Label({text:"{splI18NModel>SELECT_DISPLAY_AREA}",id:"SapSplDisplayAreaNameLabel"});this.oDisplayAreaButton=new sap.m.Button({icon:"sap-icon://arrow-down",press:function(e){splReusable.libs.SapSplStyleSheetLoader.loadStyle("./resources/styles/sapSplDisplayAreaDialogs");var s=sap.ui.view({viewName:"splView.dialogs.SplDisplayAreaList",type:sap.ui.core.mvc.ViewType.XML,viewData:a});var b=new sap.m.Button({text:"{splI18NModel>CREATE_DISPLAY_AREA}"});var E=new sap.m.Button({text:"{splI18NModel>DISPLAY_AREA_SETTINGS}"});s.getController().setBeginButton(b);s.getController().setEndButton(E);new sap.m.ResponsivePopover({placement:"Bottom",modal:false,content:s,beginButton:b,endButton:E,contentWidth:"20em",title:"{splI18NModel>DISPLAY_AREAS}"}).openBy(e.getSource());}});this.oBarContentLayout=new sap.ui.commons.layout.HorizontalLayout({content:[this.oSearchHorizontalLayout,this.oMapsFilterLayout]}).addStyleClass("splMapTollbarBarContentLayout");this.oSapMapToolbarBar=new sap.m.Bar({contentLeft:[this.oNavButton,this.oCollapseExpandLeftPanelButton,this.oDisplayAreaLabel,this.oDisplayAreaButton],contentMiddle:[this.oTrafficStatusTitleLabel],contentRight:[this.oBarContentLayout]}).setModel(this.oMapToolbarJSONModel).addStyleClass("splMapTollbarBar");this.oSapMapToolbarBar.setEnabled=function(M){a.setEnabled(M);};this.oSapMapToolbarBar.refreshMap=function(f){a.refreshMap(f);};this.oSapMapToolbarBar.firePressOnMapFilter=function(T){a.firePressOnMapFilter(T);};this.oSapMapToolbarBar.addFeedlistControl=function(){if(t.feedlistVisible){a.addFeedlistControl();}};this.oSapMapToolbarBar.getSearchFieldLayoutInstance=function(){return a.oSearchHorizontalLayout.getSearchFieldInstance();};this.oSapMapToolbarBar.getLiveFeedInstance=function(){return a.oFeedListControl;};this.oSapMapToolbarBar.setMapFilterCallback=function(c){a.setMapFilterCallback(c);};this.oSapMapToolbarBar.getMapFilterInstance=function(){return a.oSapSplMapFilter;};return this.oSapMapToolbarBar;};
splReusable.libs.SapSplMapToolbar.prototype.mapFilterPress=function(){};
splReusable.libs.SapSplMapToolbar.prototype.instantiateMapFilter=function(){function s(d){this.oLocationTypeData=d;this.oLocationTypeData["labelResults"]=[{value:oSapSplUtils.getBundle().getText("TRUCKS"),ID:"Trucks",enabled:true,visible:splReusable.libs.SapSplModelFormatters.sapSplGetVisibilityBasedOnSubscriptionModel(sap.ui.getCore().getModel("sapSplAppConfigDataModel").getData()["isTrucksLabelVisible"]),checked:true},{value:oSapSplUtils.getBundle().getText("GEOFENCES"),ID:"Geofence",enabled:false,visible:false}];var x=jQuery(".filterTable");delete x;var m=new sap.ui.model.json.JSONModel(this.oLocationTypeData);oSapSplUtils.setSplModelFilterControlInstance(this.oSapSplVBMapFilter);this.oSapSplMapFilter.setModel(m);}function f(e){if(e){sap.ca.ui.message.showMessageBox({type:sap.ca.ui.message.Type.ERROR,message:e["response"]["statusCode"]+" "+e["response"]["statusText"],details:e["message"]+"\n"+e["response"]["requestUri"]});}throw new Error("Location Type read failed");}this.oSapSplApplModel=sap.ui.getCore().getModel("LiveAppODataModel");this.oSapSplApplModel.read("/LocationViewEnum",null,null,true,jQuery.proxy(s,this),jQuery.proxy(f,this));this.oSapSplVBMapFilter=new splReusable.libs.SapSplMapFilterControl({width:"280px",showList:true,mapInstance:this.oMapInstance});this.oSapSplMapFilter=this.oSapSplVBMapFilter.getFilter();return this.oSapSplMapFilter;};
splReusable.libs.SapSplMapToolbar.prototype.addFeedlistControl=function(){var t=this;var c=function(m){t.oSearchHorizontalLayout.getSearchFieldInstance().fnExpandCollapseSearchField("Collapse");t.oSearchHorizontalLayout.getExpandedSearchListCloseButton().firePress();if(m==="Expand"){t.oFeedListControl.getContent()[1].removeStyleClass("liveFeedHidden");}else{t.oFeedListControl.getContent()[1].addStyleClass("liveFeedHidden");}};var e=function(E){var t=this,i,f;f=t.oFeedList;t.oNav.back();$(".contextBarParentDiv").remove();var s=E.getSource();t.oPressedFilterButton=s;var S=E.getSource().getParent();var C=s.getBindingContext().getProperty("name");if(s.hasStyleClass("addHighlight")){t.BlockerLayout.addStyleClass("sapSplFeedBlockerHide");c("Collapse");for(i=0;i<S.getItems().length;i++){S.getItems()[i].removeStyleClass("addHighlight");}t.oFeedList.setShowNoData(false);s.removeStyleClass("addHighlight");}else{t.BlockerLayout.removeStyleClass("sapSplFeedBlockerHide");c("Expand");t.oFeedList.setShowNoData(false);for(i=0;i<S.getItems().length;i++){S.getItems()[i].removeStyleClass("addHighlight");}s.addStyleClass("addHighlight");if(C==="All"){t.oFeedListFilterLabel.setText(oSapSplUtils.getBundle().getText("ALL_MESSAGES"));t.oFeedList.setNoDataText(oSapSplUtils.getBundle().getText("NO_MESSAGES_TEXT"));}else if(C==="Bupa"){t.oFeedListFilterLabel.setText(oSapSplUtils.getBundle().getText("BUSINESS_PARTNER_MESSAGES"));t.oFeedList.setNoDataText(oSapSplUtils.getBundle().getText("NO_BUSINESS_PARTNER_MESSAGES_TEXT"));}else if(C==="HPA"){t.oFeedListFilterLabel.setText(oSapSplUtils.getBundle().getText("PORT_MESSAGES"));t.oFeedList.setNoDataText(oSapSplUtils.getBundle().getText("NO_PORT_MESSAGES_TEXT"));}else if(C==="Truck"){t.oFeedListFilterLabel.setText(oSapSplUtils.getBundle().getText("DRIVER_MESSAGES"));t.oFeedList.setNoDataText(oSapSplUtils.getBundle().getText("NO_DRIVER_MESSAGES_TEXT"));}else if(C==="Orders"){t.oFeedListFilterLabel.setText(oSapSplUtils.getBundle().getText("ORDER_MESSAGES"));t.oFeedList.setNoDataText(oSapSplUtils.getBundle().getText("NO_ORDER_MESSAGES_TEXT"));}else if(C==="Traffic"){t.oFeedListFilterLabel.setText(oSapSplUtils.getBundle().getText("TRAFFIC_MESSAGES"));t.oFeedList.setNoDataText(oSapSplUtils.getBundle().getText("NO_TRAFFIC_MESSAGES_TEXT"));}else if(C==="Sent"){t.oFeedListFilterLabel.setText(oSapSplUtils.getBundle().getText("SENT_MESSAGES"));t.oFeedList.setNoDataText(oSapSplUtils.getBundle().getText("NO_SENT_MESSAGES_TEXT"));}window.setTimeout(function(){t.oFeedList.setShowNoData(false);if(C==="All"){t.oFeedList.unbindAggregation("items");t.oFeedList.bindItems({path:"/MyFeed",template:t.getListItemInstance(),sorter:new sap.ui.model.Sorter("ReportedTime",true),filters:[]});}else if(C==="Bupa"){var F=[new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"BM"),new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"BI"),new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"TC"),new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"CR"),new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"AG"),new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"RG"),new sap.ui.model.Filter("isNotification",sap.ui.model.FilterOperator.EQ,"1")];t.oFeedList.unbindAggregation("items");t.oFeedList.bindItems({path:"/MyFeed",template:t.getListItemInstance(),sorter:new sap.ui.model.Sorter("ReportedTime",true),filters:new sap.ui.model.Filter(F)});}else if(C==="HPA"){t.oFeedList.unbindAggregation("items");t.oFeedList.bindItems({path:"/MyFeed",template:t.getListItemInstance(),sorter:new sap.ui.model.Sorter("ReportedTime",true),filters:[new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"I")]});}else if(C==="Truck"){t.oFeedList.unbindAggregation("items");t.oFeedList.bindItems({path:"/MyFeed",template:t.getListItemInstance(),sorter:new sap.ui.model.Sorter("ReportedTime",true),filters:[new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"DM")]});}else if(C==="Orders"){t.oFeedList.unbindAggregation("items");t.oFeedList.bindItems({path:"/MyFeed",template:t.getListItemInstance(),sorter:new sap.ui.model.Sorter("ReportedTime",true),filters:[new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"E")]});}else if(C==="Traffic"){t.oFeedList.unbindAggregation("items");t.oFeedList.bindItems({path:"/MyFeed",template:t.getListItemInstance(),sorter:new sap.ui.model.Sorter("ReportedTime",true),filters:[new sap.ui.model.Filter("MessageType",sap.ui.model.FilterOperator.EQ,"TM")]});}else if(C==="Sent"){t.oFeedList.unbindAggregation("items");t.oFeedList.bindItems({path:"/SentMessage",template:t.getListItemInstanceForSentItems(),sorter:new sap.ui.model.Sorter("ReportedTime",true)});}},0);}};var d={allowFeedListSelection:splReusable.libs.SapSplModelFormatters.sapSplGetVisibilityBasedOnSubscriptionModel(sap.ui.getCore().getModel("sapSplAppConfigDataModel").getData()["isFeedContextEnabled"]),showCollapseButton:true,feedControlEventHandler:e,collapseFeedHandler:c,parentControllerInstance:this.parentControllerInstance,sMessageEntity:"/MyFeed",refreshMode:"Auto",refreshInterval:SapSplEnums.LiveFeedPollingTime,feedFilters:[{name:"All",icon:"All",visible:true,tooltip:oSapSplUtils.getBundle().getText("ALL_FILTER_TOOLTIP")},{name:"HPA",icon:"sap-icon://bussiness-suite/icon-traffic-lights",visible:splReusable.libs.SapSplModelFormatters.sapSplGetVisibilityBasedOnSubscriptionModel(sap.ui.getCore().getModel("sapSplAppConfigDataModel").getData()["FeedIncidentMessage"]),tooltip:oSapSplUtils.getBundle().getText("PORT_MESSAGES")},{name:"Traffic",icon:"sap-icon://bussiness-suite/icon-traffic-cone",visible:splReusable.libs.SapSplModelFormatters.sapSplGetVisibilityBasedOnSubscriptionModel(sap.ui.getCore().getModel("sapSplAppConfigDataModel").getData()["FeedTrafficMessage"]),tooltip:oSapSplUtils.getBundle().getText("TRAFFIC_MESSAGES")},{name:"Truck",icon:"sap-icon://bussiness-suite/icon-truck-driver",visible:splReusable.libs.SapSplModelFormatters.sapSplGetVisibilityBasedOnSubscriptionModel(sap.ui.getCore().getModel("sapSplAppConfigDataModel").getData()["FeedDriverMessage"]),tooltip:oSapSplUtils.getBundle().getText("DRIVER_MESSAGES")},{name:"Orders",icon:"sap-icon://bussiness-suite/icon-container-loading",visible:splReusable.libs.SapSplModelFormatters.sapSplGetVisibilityBasedOnSubscriptionModel(sap.ui.getCore().getModel("sapSplAppConfigDataModel").getData()["FeedTourMessage"]),tooltip:oSapSplUtils.getBundle().getText("ORDER_MESSAGES")},{name:"Bupa",icon:"sap-icon://collaborate",visible:splReusable.libs.SapSplModelFormatters.sapSplGetVisibilityBasedOnSubscriptionModel(sap.ui.getCore().getModel("sapSplAppConfigDataModel").getData()["FeedPartnerMessage"]),tooltip:oSapSplUtils.getBundle().getText("BUSINESS_PARTNER_MESSAGES")},{name:"Sent",icon:"sap-icon://display-more",visible:true,tooltip:oSapSplUtils.getBundle().getText("SENT_MESSAGES")},{name:"Filter",icon:"sap-icon://wrench",visible:true,tooltip:oSapSplUtils.getBundle().getText("MESSAGE_PREFERENCES")}]};if(this.oBarContentLayout.getContent().length<=2){this.oFeedListControl=new splReusable.libs.SapSplLiveFeedControl(d);this.oBarContentLayout.insertContent(this.oFeedListControl,2);}};
splReusable.libs.SapSplMapToolbar.prototype.setEnabled=function(m){if(m){this.oSearchHorizontalLayout.setEnabled(true);this.oMapButton.setEnabled(true);}else{this.oSearchHorizontalLayout.setEnabled(false);this.oMapButton.setEnabled(false);}};
splReusable.libs.SapSplMapToolbar.prototype.refreshMap=function(f){this.oSapSplVBMapFilter.refreshMap(f);};
splReusable.libs.SapSplMapToolbar.prototype.setMapFilterCallback=function(c){this.oSapSplVBMapFilter.setCallback(c);};
splReusable.libs.SapSplMapToolbar.prototype.firePressOnMapFilter=function(t){var m=this.oSapSplMapFilter.getModel().getData().results;var I=null;for(var i=0;i<m.length;i++){if(m[i]["Value"]===t){I=i;break;}}if(this.oSapSplMapFilter.getContent()[0].getItems()[I]){var s=this.oSapSplMapFilter.getContent()[0].getItems()[I].getCells()[0].getContentLeft()[0];if(s.hasStyleClass("opacityLow")){s.firePress();}}};
